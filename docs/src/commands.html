
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ModalEdit - Commands</title>
    <link rel="icon" type="image/icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/main.css" />
    
    
</head>
<body>
    
    <div class="navbar">
        <div class="navmenu">
            
    <a class="title enabled" href="../index.html">
        <img src="../images/escape.svg" />
        <span>ModalEdit</span>
    </a>
    <a class="enabled" href="https://marketplace.visualstudio.com/items?itemName=johtela.vscode-modaledit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z"/></svg>
        <span>Download</span>
    </a>
    <a class="enabled" href="https://github.com/johtela/vscode-modaledit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
        <span>GitHub</span>
    </a>
    <a class="enabled" href="../LICENSE.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zM64 72c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8V72zm0 64c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8v-16zm192.81 248H304c8.84 0 16 7.16 16 16s-7.16 16-16 16h-47.19c-16.45 0-31.27-9.14-38.64-23.86-2.95-5.92-8.09-6.52-10.17-6.52s-7.22.59-10.02 6.19l-7.67 15.34a15.986 15.986 0 0 1-14.31 8.84c-.38 0-.75-.02-1.14-.05-6.45-.45-12-4.75-14.03-10.89L144 354.59l-10.61 31.88c-5.89 17.66-22.38 29.53-41 29.53H80c-8.84 0-16-7.16-16-16s7.16-16 16-16h12.39c4.83 0 9.11-3.08 10.64-7.66l18.19-54.64c3.3-9.81 12.44-16.41 22.78-16.41s19.48 6.59 22.77 16.41l13.88 41.64c19.77-16.19 54.05-9.7 66 14.16 2.02 4.06 5.96 6.5 10.16 6.5zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"/></svg>
        <span>License</span>
    </a>
    <a class="enabled" href="actions.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"/></svg>
        <span>Previous: Actions</span>
    </a>
    <a class="enabled" href="../CHANGELOG.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"/></svg>
        <span>Next: Changelog</span>
    </a>
        </div>
        
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
    </div>
    
    <div class="layout">
        <div class="sidepane collapsible">
            
    <div class="tocmenu">
        <h3>Table of Contents</h3>
        
    <ul>
        
    <li>
        
        <a href="../README.html">Home</a>
        
    </li>
    <li>
        
        <a href="../.vscode/settings.html">Tutorial</a>
        
    </li>
    <li>
        <button class="accordion">
        Implementation
        </button>
            
    <ul>
        
    <li>
        
        <a href="extension.html">Extension</a>
        
    </li>
    <li>
        
        <a href="actions.html">Actions</a>
        
    </li>
    <li>
        
        <a href="commands.html" class="highlight">Commands</a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="../CHANGELOG.html">Changelog</a>
        
    </li>
    <li>
        
        <a href="../LICENSE.html">License</a>
        
    </li>
    <li>
        
        <a href="../tutorial.html">tutorial</a>
        
    </li>
    </ul>
    </div>
            
    <div class="footer">
        Copyright Â© 2020 Tommi Johtela
        <div class="ad">
            Created with <a href="https://github.com/johtela/litscript">LiTScript</a>
        </div>
    </div>

        </div>
        <div class="sideicon collapsible">
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        <div class="scrollingarea closepopups">
            
    <div class="contentarea">
        <h1 id="commands-and-state">Commands and State</h1>
<p>This module implements the new commands provided by ModalEdit. It also stores
the extension state; which mode we are in, search parameters, bookmarks,
quick snippets, etc.</p>
<details>
<summary>commands.ts imports</summary>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="264" data-toggle="tooltip" data-title="typeof vscode">vscode</span> <span class="keyword">from</span> <span class="string">&#039;vscode&#039;</span>
<span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="298" data-toggle="tooltip" data-title="typeof actions">actions</span> <span class="keyword">from</span> <span class="string">&#039;./actions&#039;</span>
</code></pre>
</details>
<h2 id="command-arguments">Command Arguments</h2>
<p>Most commands provided by ModalEdit take arguments. Since command arguments
are stored in objects by-design, we define them as interfaces.</p>
<h3 id="search-arguments">Search Arguments</h3>
<p>Search arguments are documented in the
<a href="../README.html#code-modaledit-search-code">README</a>.</p>
<pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="328" class="typename" data-toggle="tooltip" data-title="SearchArgs">SearchArgs</span> <span class="punctuation">{</span>
    <span id="690" data-toggle="tooltip" data-title="boolean | undefined">backwards</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="715" data-toggle="tooltip" data-title="boolean | undefined">caseSensitive</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="744" data-toggle="tooltip" data-title="boolean | undefined">wrapAround</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="770" data-toggle="tooltip" data-title="number | undefined">acceptAfter</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">number</span>
    <span id="796" data-toggle="tooltip" data-title="boolean | undefined">selectTillMatch</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="827" data-toggle="tooltip" data-title="string | undefined">typeAfterAccept</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="857" data-toggle="tooltip" data-title="string | undefined">typeBeforeNextMatch</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="891" data-toggle="tooltip" data-title="string | undefined">typeAfterNextMatch</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="924" data-toggle="tooltip" data-title="string | undefined">typeBeforePreviousMatch</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="962" data-toggle="tooltip" data-title="string | undefined">typeAfterPreviousMatch</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="bookmark-arguments">Bookmark Arguments</h3>
<p><a href="../README.html#bookmarks">Bookmark</a> ID is just an index in an array. The
actual positions are stored in an object that conforms to the <code>Bookmark</code>
interface in the <code>bookmarks</code> array.</p>
<pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="1002" class="typename" data-toggle="tooltip" data-title="BookmarkArgs">BookmarkArgs</span> <span class="punctuation">{</span>
    <span id="1267" data-toggle="tooltip" data-title="number | undefined">bookmark</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">number</span>
<span class="punctuation">}</span>

<span class="keyword">interface</span> <span id="1293" class="typename" data-toggle="tooltip" data-title="Bookmark">Bookmark</span> <span class="punctuation">{</span>
    <span id="1317" data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextDocument">TextDocument</span>
    <span id="1352" data-toggle="tooltip" data-title="vscode.Position">position</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Position">Position</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="quick-snippet-arguments">Quick Snippet Arguments</h3>
<p><a href="../README.html#quick-snippets">Quick snippets</a> are also stored in an array.
So their IDs are indexes as well.</p>
<pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="1386" class="typename" data-toggle="tooltip" data-title="QuickSnippetArgs">QuickSnippetArgs</span> <span class="punctuation">{</span>
    <span id="1582" data-toggle="tooltip" data-title="number">snippet</span><span class="punctuation">:</span> <span class="keyword">number</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="type-normal-keys-arguments">Type Normal Keys Arguments</h3>
<p>The <a href="../README.html#invoking-key-bindings"><code>typeNormalKeys</code> command</a> gets the
entered keys as a string.</p>
<pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="1606" class="typename" data-toggle="tooltip" data-title="TypeNormalKeysArgs">TypeNormalKeysArgs</span> <span class="punctuation">{</span>
    <span id="1801" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <span class="keyword">string</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="select-between-arguments">Select Between Arguments</h3>
<p>The <code>selectBetween</code> command takes as arguments the strings/regular
expressions which delimit the text to be selected. Both of them are optional,
but in order for the command to do anything one of them needs to be defined.
If the <code>from</code> argument is missing, the selection goes from the cursor
position forwards to the <code>to</code> string. If the <code>to</code> is missing the selection
goes backwards till the <code>from</code> string.</p>
<p>If the <code>regex</code> flag is on, <code>from</code> and <code>to</code> strings are treated as regular
expressions in the search.</p>
<p>The <code>inclusive</code> flag tells if the delimiter strings are included in the
selection or not. By default the delimiter strings are not part of the
selection. Last, the <code>caseSensitive</code> flag makes the search case sensitive.
When this flag is missing or false the search is case insensitive.</p>
<p>By default the search scope is the current line. If you want search inside
the whole document, set the <code>docScope</code> flag.</p>
<pre class="syntaxhighlight"><code><span class="keyword">interface</span> <span id="1822" class="typename" data-toggle="tooltip" data-title="SelectBetweenArgs">SelectBetweenArgs</span> <span class="punctuation">{</span>
    <span id="2893" data-toggle="tooltip" data-title="string">from</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="2911" data-toggle="tooltip" data-title="string">to</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="2927" data-toggle="tooltip" data-title="boolean">regex</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="2947" data-toggle="tooltip" data-title="boolean">inclusive</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="2971" data-toggle="tooltip" data-title="boolean">caseSensitive</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
    <span id="2999" data-toggle="tooltip" data-title="boolean">docScope</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="state-variables">State Variables</h2>
<p>The enabler for modal editing is the <code>type</code> event that VS Code provides. It
reroutes the user's key presses to our extension. We store the handler to
this event in the <code>typeSubscription</code> variable.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3278" data-toggle="tooltip" data-title="vscode.Disposable | undefined">typeSubscription</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Disposable">Disposable</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
</code></pre>
<p>We add an item in the status bar that shows the current mode. The reference
to the status bar item is stored below.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3465" data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.StatusBarItem">StatusBarItem</span>
</code></pre>
<p>This is the main mode flag that tells if we are in normal mode or insert
mode.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3604" data-toggle="tooltip" data-title="boolean">normalMode</span> <span class="punctuation">=</span> <span class="keyword">true</span>
</code></pre>
<p>The <code>selecting</code> flag indicates if we have initiated selection mode. Note that
it is not the only indicator that tells whether a selection is active.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3794" data-toggle="tooltip" data-title="boolean">selecting</span> <span class="punctuation">=</span> <span class="keyword">false</span>
</code></pre>
<p>The <code>searching</code> flag tells if <code>modaledit.search</code> command is in operation.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3907" data-toggle="tooltip" data-title="boolean">searching</span> <span class="punctuation">=</span> <span class="keyword">false</span>
</code></pre>
<p>Search state variables.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3968" data-toggle="tooltip" data-title="string">searchString</span><span class="punctuation">:</span> <span class="keyword">string</span>
<span class="keyword">let</span> <span id="3994" data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Selection">Selection</span><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>Current search parameters.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4083" data-toggle="tooltip" data-title="boolean">searchBackwards</span> <span class="punctuation">=</span> <span class="keyword">false</span>
<span class="keyword">let</span> <span id="4112" data-toggle="tooltip" data-title="boolean">searchCaseSensitive</span> <span class="punctuation">=</span> <span class="keyword">false</span>
<span class="keyword">let</span> <span id="4145" data-toggle="tooltip" data-title="boolean">searchWrapAround</span> <span class="punctuation">=</span> <span class="keyword">false</span>
<span class="keyword">let</span> <span id="4175" data-toggle="tooltip" data-title="number">searchAcceptAfter</span> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">POSITIVE_INFINITY</span>
<span class="keyword">let</span> <span id="4225" data-toggle="tooltip" data-title="boolean">searchSelectTillMatch</span> <span class="punctuation">=</span> <span class="keyword">false</span>
<span class="keyword">let</span> <span id="4260" data-toggle="tooltip" data-title="string | undefined">searchTypeAfterAccept</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
<span class="keyword">let</span> <span id="4307" data-toggle="tooltip" data-title="string | undefined">searchTypeBeforeNextMatch</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
<span class="keyword">let</span> <span id="4358" data-toggle="tooltip" data-title="string | undefined">searchTypeAfterNextMatch</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
<span class="keyword">let</span> <span id="4408" data-toggle="tooltip" data-title="string | undefined">searchTypeBeforePreviousMatch</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
<span class="keyword">let</span> <span id="4463" data-toggle="tooltip" data-title="string | undefined">searchTypeAfterPreviousMatch</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span>
<span class="keyword">let</span> <span id="4517" data-toggle="tooltip" data-title="boolean">searchReturnToNormal</span> <span class="punctuation">=</span> <span class="keyword">true</span>
</code></pre>
<p>Bookmarks are stored here.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4591" data-toggle="tooltip" data-title="Bookmark[]">bookmarks</span><span class="punctuation">:</span> <a href="commands.html#1293"><span class="typename" data-toggle="tooltip" data-title="Bookmark">Bookmark</span></a><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>Quick snippets are simply stored in an array of strings.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4694" data-toggle="tooltip" data-title="string[]">quickSnippets</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>&quot;Repeat last change&quot; command needs to know when text in editor has changed.
It also needs to save the current and last command key sequence, as well as
the last sequence that caused text to change.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4948" data-toggle="tooltip" data-title="boolean">textChanged</span> <span class="punctuation">=</span> <span class="keyword">false</span>
<span class="keyword">let</span> <span id="4973" data-toggle="tooltip" data-title="string[]">currentKeySequence</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
<span class="keyword">let</span> <span id="5012" data-toggle="tooltip" data-title="string[]">lastKeySequence</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
<span class="keyword">let</span> <span id="5048" data-toggle="tooltip" data-title="string[]">lastChange</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<h2 id="command-names">Command Names</h2>
<p>Since command names are easy to misspell, we define them as constants.</p>
<pre class="syntaxhighlight"><code><span class="keyword">const</span> <span id="5192" data-toggle="tooltip" data-title="&quot;modaledit.toggle&quot;">toggleId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.toggle&quot;</span>
<span class="keyword">const</span> <span id="5229" data-toggle="tooltip" data-title="&quot;modaledit.enterNormal&quot;">enterNormalId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.enterNormal&quot;</span>
<span class="keyword">const</span> <span id="5276" data-toggle="tooltip" data-title="&quot;modaledit.enterInsert&quot;">enterInsertId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.enterInsert&quot;</span>
<span class="keyword">const</span> <span id="5323" data-toggle="tooltip" data-title="&quot;modaledit.toggleSelection&quot;">toggleSelectionId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.toggleSelection&quot;</span>
<span class="keyword">const</span> <span id="5378" data-toggle="tooltip" data-title="&quot;modaledit.cancelSelection&quot;">cancelSelectionId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.cancelSelection&quot;</span>
<span class="keyword">const</span> <span id="5433" data-toggle="tooltip" data-title="&quot;modaledit.search&quot;">searchId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.search&quot;</span>
<span class="keyword">const</span> <span id="5470" data-toggle="tooltip" data-title="&quot;modaledit.cancelSearch&quot;">cancelSearchId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.cancelSearch&quot;</span>
<span class="keyword">const</span> <span id="5519" data-toggle="tooltip" data-title="&quot;modaledit.deleteCharFromSearch&quot;">deleteCharFromSearchId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.deleteCharFromSearch&quot;</span>
<span class="keyword">const</span> <span id="5584" data-toggle="tooltip" data-title="&quot;modaledit.nextMatch&quot;">nextMatchId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.nextMatch&quot;</span>
<span class="keyword">const</span> <span id="5627" data-toggle="tooltip" data-title="&quot;modaledit.previousMatch&quot;">previousMatchId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.previousMatch&quot;</span>
<span class="keyword">const</span> <span id="5678" data-toggle="tooltip" data-title="&quot;modaledit.defineBookmark&quot;">defineBookmarkId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.defineBookmark&quot;</span>
<span class="keyword">const</span> <span id="5731" data-toggle="tooltip" data-title="&quot;modaledit.goToBookmark&quot;">goToBookmarkId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.goToBookmark&quot;</span>
<span class="keyword">const</span> <span id="5780" data-toggle="tooltip" data-title="&quot;modaledit.fillSnippetArgs&quot;">fillSnippetArgsId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.fillSnippetArgs&quot;</span>
<span class="keyword">const</span> <span id="5835" data-toggle="tooltip" data-title="&quot;modaledit.defineQuickSnippet&quot;">defineQuickSnippetId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.defineQuickSnippet&quot;</span>
<span class="keyword">const</span> <span id="5896" data-toggle="tooltip" data-title="&quot;modaledit.insertQuickSnippet&quot;">insertQuickSnippetId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.insertQuickSnippet&quot;</span>
<span class="keyword">const</span> <span id="5957" data-toggle="tooltip" data-title="&quot;modaledit.typeNormalKeys&quot;">typeNormalKeysId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.typeNormalKeys&quot;</span>
<span class="keyword">const</span> <span id="6010" data-toggle="tooltip" data-title="&quot;modaledit.selectBetween&quot;">selectBetweenId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.selectBetween&quot;</span>
<span class="keyword">const</span> <span id="6061" data-toggle="tooltip" data-title="&quot;modaledit.repeatLastChange&quot;">repeatLastChangeId</span> <span class="punctuation">=</span> <span class="string">&quot;modaledit.repeatLastChange&quot;</span>
</code></pre>
<h2 id="registering-commands">Registering Commands</h2>
<p>The commands are registered when the extension is activated (main entry point
calls this function). We also create the status bar item.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="6111" class="member" data-toggle="tooltip" data-title="(context: vscode.ExtensionContext) =&gt; void">register</span><span class="punctuation">(</span><span id="6325" data-toggle="tooltip" data-title="vscode.ExtensionContext">context</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.ExtensionContext">ExtensionContext</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#6325"><span data-toggle="tooltip" data-title="vscode.ExtensionContext">context</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="{ dispose(): any; }[]">subscriptions</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: { dispose(): any; }[]) =&gt; number">push</span><span class="punctuation">(</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5192"><span data-toggle="tooltip" data-title="&quot;modaledit.toggle&quot;">toggleId</span></a><span class="punctuation">,</span> <a href="commands.html#9595"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">toggle</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5229"><span data-toggle="tooltip" data-title="&quot;modaledit.enterNormal&quot;">enterNormalId</span></a><span class="punctuation">,</span> <a href="commands.html#9804"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterNormal</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5276"><span data-toggle="tooltip" data-title="&quot;modaledit.enterInsert&quot;">enterInsertId</span></a><span class="punctuation">,</span> <a href="commands.html#10244"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterInsert</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5323"><span data-toggle="tooltip" data-title="&quot;modaledit.toggleSelection&quot;">toggleSelectionId</span></a><span class="punctuation">,</span> <a href="commands.html#13403"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">toggleSelection</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5378"><span data-toggle="tooltip" data-title="&quot;modaledit.cancelSelection&quot;">cancelSelectionId</span></a><span class="punctuation">,</span> <a href="commands.html#12883"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSelection</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5433"><span data-toggle="tooltip" data-title="&quot;modaledit.search&quot;">searchId</span></a><span class="punctuation">,</span> <a href="commands.html#15055"><span class="member" data-toggle="tooltip" data-title="(args: string | SearchArgs) =&gt; Promise&lt;void&gt;">search</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5470"><span data-toggle="tooltip" data-title="&quot;modaledit.cancelSearch&quot;">cancelSearchId</span></a><span class="punctuation">,</span> <a href="commands.html#21686"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSearch</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5519"><span data-toggle="tooltip" data-title="&quot;modaledit.deleteCharFromSearch&quot;">deleteCharFromSearchId</span></a><span class="punctuation">,</span>
            <a href="commands.html#22129"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">deleteCharFromSearch</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5584"><span data-toggle="tooltip" data-title="&quot;modaledit.nextMatch&quot;">nextMatchId</span></a><span class="punctuation">,</span> <a href="commands.html#23305"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">nextMatch</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5627"><span data-toggle="tooltip" data-title="&quot;modaledit.previousMatch&quot;">previousMatchId</span></a><span class="punctuation">,</span> <a href="commands.html#24178"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">previousMatch</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5678"><span data-toggle="tooltip" data-title="&quot;modaledit.defineBookmark&quot;">defineBookmarkId</span></a><span class="punctuation">,</span> <a href="commands.html#24840"><span class="member" data-toggle="tooltip" data-title="(args?: BookmarkArgs | undefined) =&gt; void">defineBookmark</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5731"><span data-toggle="tooltip" data-title="&quot;modaledit.goToBookmark&quot;">goToBookmarkId</span></a><span class="punctuation">,</span> <a href="commands.html#25296"><span class="member" data-toggle="tooltip" data-title="(args?: BookmarkArgs | undefined) =&gt; Promise&lt;void&gt;">goToBookmark</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5780"><span data-toggle="tooltip" data-title="&quot;modaledit.fillSnippetArgs&quot;">fillSnippetArgsId</span></a><span class="punctuation">,</span> <a href="commands.html#26153"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">fillSnippetArgs</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5835"><span data-toggle="tooltip" data-title="&quot;modaledit.defineQuickSnippet&quot;">defineQuickSnippetId</span></a><span class="punctuation">,</span> <a href="commands.html#26696"><span class="member" data-toggle="tooltip" data-title="(args?: QuickSnippetArgs | undefined) =&gt; void">defineQuickSnippet</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5896"><span data-toggle="tooltip" data-title="&quot;modaledit.insertQuickSnippet&quot;">insertQuickSnippetId</span></a><span class="punctuation">,</span> <a href="commands.html#26993"><span class="member" data-toggle="tooltip" data-title="(args?: QuickSnippetArgs | undefined) =&gt; Promise&lt;void&gt;">insertQuickSnippet</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#5957"><span data-toggle="tooltip" data-title="&quot;modaledit.typeNormalKeys&quot;">typeNormalKeysId</span></a><span class="punctuation">,</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#6010"><span data-toggle="tooltip" data-title="&quot;modaledit.selectBetween&quot;">selectBetweenId</span></a><span class="punctuation">,</span> <a href="commands.html#27971"><span class="member" data-toggle="tooltip" data-title="(args: SelectBetweenArgs) =&gt; void">selectBetween</span></a><span class="punctuation">)</span><span class="punctuation">,</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><a href="commands.html#6061"><span data-toggle="tooltip" data-title="&quot;modaledit.repeatLastChange&quot;">repeatLastChangeId</span></a><span class="punctuation">,</span> <a href="commands.html#31259"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">repeatLastChange</span></a><span class="punctuation">)</span>
    <span class="punctuation">)</span>
    <a href="commands.html#3465"><span data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span></a> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(alignment?: vscode.StatusBarAlignment | undefined, priority?: number | undefined) =&gt; vscode.StatusBarItem">createStatusBarItem</span><span class="punctuation">(</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.StatusBarAlignment">StatusBarAlignment</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.StatusBarAlignment.Left">Left</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <a href="commands.html#3465"><span data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string | vscode.Command | undefined">command</span> <span class="punctuation">=</span> <a href="commands.html#5192"><span data-toggle="tooltip" data-title="&quot;modaledit.toggle&quot;">toggleId</span></a><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="keyboard-event-handler">Keyboard Event Handler</h2>
<p>When the user types in normal mode, <code>onType</code> handler gets each typed
character one at a time. It calls the <code>runActionForKey</code> subroutine to invoke
the action bound to the typed key. In addition, it updates the state
variables needed by the <code>repeatLastChange</code> command and the status bar.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="7892" class="member" data-toggle="tooltip" data-title="(event: { text: string; }) =&gt; Promise&lt;void&gt;">onType</span><span class="punctuation">(</span><span id="8265" data-toggle="tooltip" data-title="{ text: string; }">event</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span id="8273" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">}</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4948"><span data-toggle="tooltip" data-title="boolean">textChanged</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="commands.html#5048"><span data-toggle="tooltip" data-title="string[]">lastChange</span></a> <span class="punctuation">=</span> <a href="commands.html#5012"><span data-toggle="tooltip" data-title="string[]">lastKeySequence</span></a>
        <a href="commands.html#4948"><span data-toggle="tooltip" data-title="boolean">textChanged</span></a> <span class="punctuation">=</span> <span class="keyword">false</span>
    <span class="punctuation">}</span>
    <a href="commands.html#4973"><span data-toggle="tooltip" data-title="string[]">currentKeySequence</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><a href="commands.html#8265"><span data-toggle="tooltip" data-title="{ text: string; }">event</span></a><span class="punctuation">.</span><a href="commands.html#8273"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">await</span> <a href="commands.html#8936"><span class="member" data-toggle="tooltip" data-title="(key: string, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">runActionForKey</span></a><span class="punctuation">(</span><a href="commands.html#8265"><span data-toggle="tooltip" data-title="{ text: string; }">event</span></a><span class="punctuation">.</span><a href="commands.html#8273"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="commands.html#5012"><span data-toggle="tooltip" data-title="string[]">lastKeySequence</span></a> <span class="punctuation">=</span> <a href="commands.html#4973"><span data-toggle="tooltip" data-title="string[]">currentKeySequence</span></a>
        <a href="commands.html#4973"><span data-toggle="tooltip" data-title="string[]">currentKeySequence</span></a> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
    <span class="punctuation">}</span>
    <a href="commands.html#12019"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span><span class="punctuation">,</span> <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#18961"><span class="member" data-toggle="tooltip" data-title="() =&gt; string | undefined">getHelp</span></a><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Whenever text changes in an active editor, we set a flag. This flag is
examined in the <code>onType</code> handler above, and the <code>lastChange</code> variable is set
to indicate that the last command that changed editor text.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="8643" class="member" data-toggle="tooltip" data-title="() =&gt; void">onTextChanged</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#4948"><span data-toggle="tooltip" data-title="boolean">textChanged</span></a> <span class="punctuation">=</span> <span class="keyword">true</span>
<span class="punctuation">}</span>
</code></pre>
<p>This helper function just calls the <code>handleKey</code> function in the <code>actions</code>
module. It checks if we have an active selection or search mode on, and
passes that information to the function. <code>handleKey</code> returns <code>true</code> if the
key actually invoked a command, or <code>false</code> if it was a part of incomplete
key sequence that did not (yet) cause any commands to run. This information
is needed to decide whether the <code>lastKeySequence</code> variable is updated.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="8936" class="member" data-toggle="tooltip" data-title="(key: string, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">runActionForKey</span><span class="punctuation">(</span><span id="9449" data-toggle="tooltip" data-title="string">key</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="9461" data-toggle="tooltip" data-title="boolean">userInitiated</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span>
    <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">boolean</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="keyword">await</span> <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#17356"><span class="member" data-toggle="tooltip" data-title="(key: string, selecting: boolean, capture: boolean, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">handleKey</span></a><span class="punctuation">(</span><a href="commands.html#9449"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">,</span> <a href="commands.html#13821"><span class="member" data-toggle="tooltip" data-title="() =&gt; boolean">isSelecting</span></a><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a><span class="punctuation">,</span> <a href="commands.html#9461"><span data-toggle="tooltip" data-title="boolean">userInitiated</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="mode-switching-commands">Mode Switching  Commands</h2>
<p><code>toggle</code> switches between normal and insert mode.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="9595" class="member" data-toggle="tooltip" data-title="() =&gt; void">toggle</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a><span class="punctuation">)</span>
        <a href="commands.html#10244"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterInsert</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">else</span>
        <a href="commands.html#9804"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterNormal</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>When entering normal mode, we:</p>
<ol>
<li>cancel the search, if it is on,</li>
<li>subscribe to the <code>type</code> event,</li>
<li>handle the rest of the mode setup with <code>setNormalMode</code> function, and</li>
<li>clear the selection.</li>
</ol>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="9804" class="member" data-toggle="tooltip" data-title="() =&gt; void">enterNormal</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#21686"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSearch</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#3278"><span data-toggle="tooltip" data-title="vscode.Disposable | undefined">typeSubscription</span></a><span class="punctuation">)</span>
        <a href="commands.html#3278"><span data-toggle="tooltip" data-title="vscode.Disposable | undefined">typeSubscription</span></a> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(command: string, callback: (...args: any[]) =&gt; any, thisArg?: any) =&gt; vscode.Disposable">registerCommand</span><span class="punctuation">(</span><span class="string">&quot;type&quot;</span><span class="punctuation">,</span> <a href="commands.html#7892"><span class="member" data-toggle="tooltip" data-title="(event: { text: string; }) =&gt; Promise&lt;void&gt;">onType</span></a><span class="punctuation">)</span>
    <a href="commands.html#10886"><span class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setNormalMode</span></a><span class="punctuation">(</span><span class="keyword">true</span><span class="punctuation">)</span>
    <a href="commands.html#12883"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSelection</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Conversely, when entering insert mode, we:</p>
<ol>
<li>cancel the search, if it is on (yes, you can use it in insert mode, too),</li>
<li>unsubscribe to the <code>type</code> event,</li>
<li>handle the rest of the mode setup with <code>setNormalMode</code> function.</li>
</ol>
<p>Note that we specifically don't clear the selection. This allows the user
to easily surround selected text with hyphens <code>'</code>, parenthesis <code>(</code> and <code>)</code>,
brackets <code>[</code> and <code>]</code>, etc.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="10244" class="member" data-toggle="tooltip" data-title="() =&gt; void">enterInsert</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#21686"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSearch</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3278"><span data-toggle="tooltip" data-title="vscode.Disposable | undefined">typeSubscription</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="commands.html#3278"><span data-toggle="tooltip" data-title="vscode.Disposable">typeSubscription</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; any">dispose</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <a href="commands.html#3278"><span data-toggle="tooltip" data-title="vscode.Disposable | undefined">typeSubscription</span></a> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="punctuation">}</span>
    <a href="commands.html#10886"><span class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setNormalMode</span></a><span class="punctuation">(</span><span class="keyword">false</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>The rest of the state handling is delegated to subroutines that do specific
things. <code>setNormalMode</code> sets or resets the VS Code <code>modaledit.normal</code> context.
This can be used in &quot;standard&quot; key bindings. Then it sets the <code>normalMode</code>
variable and calls the next subroutine which updates cursor and status bar.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="10886" class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setNormalMode</span><span class="punctuation">(</span><span id="11251" data-toggle="tooltip" data-title="boolean">value</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">const</span> <span id="11294" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#11294"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><span class="string">&quot;setContext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;modaledit.normal&quot;</span><span class="punctuation">,</span>
            <a href="commands.html#11251"><span data-toggle="tooltip" data-title="boolean">value</span></a><span class="punctuation">)</span>
        <a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a> <span class="punctuation">=</span> <a href="commands.html#11251"><span data-toggle="tooltip" data-title="boolean">value</span></a>
        <a href="commands.html#11533"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined) =&gt; void">updateCursorAndStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#11294"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>This function updates the cursor shape according to the mode. It delegates
updating of the status bar to the next subroutine.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="11533" class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined) =&gt; void">updateCursorAndStatusBar</span><span class="punctuation">(</span><span id="11720" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditor">TextEditor</span> <span class="punctuation">|</span> <span class="keyword">undefined</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#11720"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
        <a href="commands.html#11720"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorOptions">options</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle | undefined">cursorStyle</span> <span class="punctuation">=</span>
            <a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a> <span class="punctuation">?</span> <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#4821"><span class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getSearchCursorType</span></a><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">:</span>
                <a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a> <span class="punctuation">?</span> <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#4714"><span class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getNormalCursorStyle</span></a><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">:</span>
                    <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#4492"><span class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getInsertCursorStyle</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <a href="commands.html#12019"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#11720"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>The last function updates the status bar text according to the mode. It also
indicates if selection is active or if search mode on. If so, it shows the
search parameters. If no editor is active, we hide the status bar item.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="12019" class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span><span class="punctuation">(</span><span id="12300" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditor">TextEditor</span> <span class="punctuation">|</span> <span class="keyword">undefined</span><span class="punctuation">,</span>
    <span id="12338" data-toggle="tooltip" data-title="string | undefined">help</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#12300"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="12392" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a><span class="punctuation">)</span>
            <a href="commands.html#12392"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">=</span> <span class="string">`SEARCH [${</span><a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">?</span> <span class="string">&quot;B&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;F&quot;</span>
                <span class="string">}${</span><a href="commands.html#4112"><span data-toggle="tooltip" data-title="boolean">searchCaseSensitive</span></a> <span class="punctuation">?</span> <span class="string">&quot;S&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">}]: ${</span><a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="string">}`</span>
        <span class="keyword">else</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="12592" data-toggle="tooltip" data-title="string">sel</span> <span class="punctuation">=</span> <a href="commands.html#13821"><span class="member" data-toggle="tooltip" data-title="() =&gt; boolean">isSelecting</span></a><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">?</span> <span class="string">&quot; [S]&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&quot;</span>
            <a href="commands.html#12392"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">=</span> <a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a> <span class="punctuation">?</span> <span class="string">`--NORMAL${</span><a href="commands.html#12592"><span data-toggle="tooltip" data-title="string">sel</span></a><span class="string">}--`</span> <span class="punctuation">:</span> <span class="string">`--INSERT${</span><a href="commands.html#12592"><span data-toggle="tooltip" data-title="string">sel</span></a><span class="string">}--`</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#12338"><span data-toggle="tooltip" data-title="string | undefined">help</span></a><span class="punctuation">)</span>
            <a href="commands.html#12392"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">=</span> <span class="string">`${</span><a href="commands.html#12392"><span data-toggle="tooltip" data-title="string">text</span></a><span class="string">}  ${</span><a href="commands.html#12338"><span data-toggle="tooltip" data-title="string">help</span></a><span class="string">}`</span>
        <a href="commands.html#3465"><span data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">text</span> <span class="punctuation">=</span> <a href="commands.html#12392"><span data-toggle="tooltip" data-title="string">text</span></a>
        <a href="commands.html#3465"><span data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; void">show</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span>
        <a href="commands.html#3465"><span data-toggle="tooltip" data-title="vscode.StatusBarItem">statusBarItem</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; void">hide</span><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="selection-commands">Selection Commands</h2>
<p><code>modaledit.cancelSelection</code> command clears the selection using ths standard
<code>cancelSelection</code> command, but also sets the <code>selecting</code> flag to false, and
updates the status bar. It is advisable to use this command instead of the
standard version to keep the state in sync.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="12883" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSelection</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><span class="string">&quot;cancelSelection&quot;</span><span class="punctuation">)</span>
    <a href="commands.html#3794"><span data-toggle="tooltip" data-title="boolean">selecting</span></a> <span class="punctuation">=</span> <span class="keyword">false</span>
    <a href="commands.html#12019"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p><code>modaledit.toggleSelection</code> toggles the selection mode on and off. It sets
the selection mode flag and updates the status bar, but also clears the
selection.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="13403" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">toggleSelection</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="13644" data-toggle="tooltip" data-title="boolean">oldSelecting</span> <span class="punctuation">=</span> <a href="commands.html#13821"><span class="member" data-toggle="tooltip" data-title="() =&gt; boolean">isSelecting</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><span class="string">&quot;cancelSelection&quot;</span><span class="punctuation">)</span>
    <a href="commands.html#3794"><span data-toggle="tooltip" data-title="boolean">selecting</span></a> <span class="punctuation">=</span> <span class="punctuation">!</span><a href="commands.html#13644"><span data-toggle="tooltip" data-title="boolean">oldSelecting</span></a>
    <a href="commands.html#12019"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>The following helper function actually determines, if a selection is active.
It checks not only the <code>selecting</code> flag but also if there is any text
selected in the active editor.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="13821" class="member" data-toggle="tooltip" data-title="() =&gt; boolean">isSelecting</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="commands.html#3794"><span data-toggle="tooltip" data-title="boolean">selecting</span></a> <span class="punctuation">||</span>
        <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span><span class="punctuation">!</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: vscode.Selection, index: number, array: vscode.Selection[]) =&gt; unknown, thisArg?: any) =&gt; boolean">some</span><span class="punctuation">(</span>
            <span id="14140" data-toggle="tooltip" data-title="vscode.Selection">selection</span> <span class="punctuation">=&gt;</span> <span class="punctuation">!</span><a href="commands.html#14140"><span data-toggle="tooltip" data-title="vscode.Selection">selection</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">anchor</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(other: vscode.Position) =&gt; boolean">isEqual</span><span class="punctuation">(</span><a href="commands.html#14140"><span data-toggle="tooltip" data-title="vscode.Selection">selection</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">active</span><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="search-commands">Search Commands</h2>
<p>Incremental search is by far the most complicated part of this extension.
Searching overrides both normal and insert modes, and captures the keyboard
until it is done. The following subroutine sets the associated state
variable, the VS Code <code>modaledit.searching</code> context, and the status bar.
Since search mode also puts the editor implicitly in the normal mode, we
need to check what was the state when we initiated the search. If we were in
insert mode, we return also there.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="14214" class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setSearching</span><span class="punctuation">(</span><span id="14789" data-toggle="tooltip" data-title="boolean">value</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a> <span class="punctuation">=</span> <a href="commands.html#14789"><span data-toggle="tooltip" data-title="boolean">value</span></a>
    <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><span class="string">&quot;setContext&quot;</span><span class="punctuation">,</span>
        <span class="string">&quot;modaledit.searching&quot;</span><span class="punctuation">,</span> <a href="commands.html#14789"><span data-toggle="tooltip" data-title="boolean">value</span></a><span class="punctuation">)</span>
    <a href="commands.html#11533"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined) =&gt; void">updateCursorAndStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><span class="punctuation">(</span><a href="commands.html#14789"><span data-toggle="tooltip" data-title="boolean">value</span></a> <span class="punctuation">||</span> <a href="commands.html#4517"><span data-toggle="tooltip" data-title="boolean">searchReturnToNormal</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="commands.html#10244"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterInsert</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>This is the main command that not only initiates the search, but also handles
the key presses when search is active. That is why its argument is defined
as an union type. We also use the argument to detect whether we are starting
a new search or adding characters to the active search.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="15055" class="member" data-toggle="tooltip" data-title="(args: string | SearchArgs) =&gt; Promise&lt;void&gt;">search</span><span class="punctuation">(</span><span id="15391" data-toggle="tooltip" data-title="string | SearchArgs">args</span><span class="punctuation">:</span> <a href="commands.html#328"><span class="typename" data-toggle="tooltip" data-title="SearchArgs">SearchArgs</span></a> <span class="punctuation">|</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="15443" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#15443"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
        <span class="keyword">return</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#15391"><span data-toggle="tooltip" data-title="string | SearchArgs">args</span></a><span class="punctuation">)</span>
        <a href="commands.html#15391"><span data-toggle="tooltip" data-title="string | SearchArgs">args</span></a> <span class="punctuation">=</span> <span class="punctuation">{</span><span class="punctuation">}</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="string | SearchArgs">args</span></a> <span class="punctuation">==</span> <span class="string">&#039;object&#039;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
</code></pre>
<p>If we get an object as argument, we start a new search. We switch
to normal mode, if necessary. Then we initialize the search string
to empty, and store the current selections in the
<code>searchStartSelections</code> array. We need an array as the command also
works with multiple cursors. Finally we store the search arguments
in the module level variables.</p>
<pre class="syntaxhighlight"><code>        <a href="commands.html#4517"><span data-toggle="tooltip" data-title="boolean">searchReturnToNormal</span></a> <span class="punctuation">=</span> <a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a>
        <a href="commands.html#298"><span data-toggle="tooltip" data-title="typeof actions">actions</span></a><span class="punctuation">.</span><a href="actions.html#5013"><span class="member" data-toggle="tooltip" data-title="(command: string) =&gt; void">setLastCommand</span></a><span class="punctuation">(</span><a href="commands.html#5433"><span data-toggle="tooltip" data-title="&quot;modaledit.search&quot;">searchId</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#3604"><span data-toggle="tooltip" data-title="boolean">normalMode</span></a><span class="punctuation">)</span>
            <a href="commands.html#9804"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterNormal</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <a href="commands.html#14214"><span class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setSearching</span></a><span class="punctuation">(</span><span class="keyword">true</span><span class="punctuation">)</span>
        <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a> <span class="punctuation">=</span> <span class="string">&quot;&quot;</span>
        <a href="commands.html#3994"><span data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span></a> <span class="punctuation">=</span> <a href="commands.html#15443"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span>
        <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#690"><span data-toggle="tooltip" data-title="boolean | undefined">backwards</span></a> <span class="punctuation">||</span> <span class="keyword">false</span>
        <a href="commands.html#4112"><span data-toggle="tooltip" data-title="boolean">searchCaseSensitive</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#715"><span data-toggle="tooltip" data-title="boolean | undefined">caseSensitive</span></a> <span class="punctuation">||</span> <span class="keyword">false</span>
        <a href="commands.html#4145"><span data-toggle="tooltip" data-title="boolean">searchWrapAround</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#744"><span data-toggle="tooltip" data-title="boolean | undefined">wrapAround</span></a> <span class="punctuation">||</span> <span class="keyword">false</span>
        <a href="commands.html#4175"><span data-toggle="tooltip" data-title="number">searchAcceptAfter</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#770"><span data-toggle="tooltip" data-title="number | undefined">acceptAfter</span></a> <span class="punctuation">||</span> <span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">POSITIVE_INFINITY</span>
        <a href="commands.html#4225"><span data-toggle="tooltip" data-title="boolean">searchSelectTillMatch</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#796"><span data-toggle="tooltip" data-title="boolean | undefined">selectTillMatch</span></a> <span class="punctuation">||</span> <span class="keyword">false</span>
        <a href="commands.html#4260"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterAccept</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#827"><span data-toggle="tooltip" data-title="string | undefined">typeAfterAccept</span></a>
        <a href="commands.html#4307"><span data-toggle="tooltip" data-title="string | undefined">searchTypeBeforeNextMatch</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#857"><span data-toggle="tooltip" data-title="string | undefined">typeBeforeNextMatch</span></a>
        <a href="commands.html#4358"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterNextMatch</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#891"><span data-toggle="tooltip" data-title="string | undefined">typeAfterNextMatch</span></a>
        <a href="commands.html#4408"><span data-toggle="tooltip" data-title="string | undefined">searchTypeBeforePreviousMatch</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#924"><span data-toggle="tooltip" data-title="string | undefined">typeBeforePreviousMatch</span></a>
        <a href="commands.html#4463"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterPreviousMatch</span></a> <span class="punctuation">=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="SearchArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#962"><span data-toggle="tooltip" data-title="string | undefined">typeAfterPreviousMatch</span></a>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#15391"><span data-toggle="tooltip" data-title="string">args</span></a> <span class="punctuation">==</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>If we get an enter character we accept the search.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">await</span> <a href="commands.html#21337"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">acceptSearch</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
</code></pre>
<p>Otherwise we just add the character to the search string and find
the next match. If <code>acceptAfter</code> argument is given, and we have a
sufficiently long search string, we accept the search automatically.</p>
<pre class="syntaxhighlight"><code>        <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a> <span class="punctuation">+=</span> <a href="commands.html#15391"><span data-toggle="tooltip" data-title="string">args</span></a>
        <a href="commands.html#17509"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, selections: vscode.Selection[]) =&gt; void">highlightMatches</span></a><span class="punctuation">(</span><a href="commands.html#15443"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#3994"><span data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span></a><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;=</span> <a href="commands.html#4175"><span data-toggle="tooltip" data-title="number">searchAcceptAfter</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="commands.html#21337"><span class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">acceptSearch</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>The actual search functionality is located in this helper function. It is
used by the actual search command plus the commands that jump to next and
previous match.</p>
<p>The search starts from positions specified by the <code>selections</code> argument. If
there are multilple selections (cursors) active, multiple searches are
performed. Each cursor location is considered separately, and the next match
from that position is selected. The function does <em>not</em> make sure that found
matches are unique. In case the matches overlap, the number of selections
will decrease.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="17509" class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, selections: vscode.Selection[]) =&gt; void">highlightMatches</span><span class="punctuation">(</span><span id="18148" data-toggle="tooltip" data-title="vscode.TextEditor">editor</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditor">TextEditor</span><span class="punctuation">,</span>
    <span id="18174" data-toggle="tooltip" data-title="vscode.Selection[]">selections</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Selection">Selection</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a> <span class="punctuation">==</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>If search string is empty, we return to the start positions.</p>
<pre class="syntaxhighlight"><code>        <a href="commands.html#18148"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span> <span class="punctuation">=</span> <a href="commands.html#3994"><span data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span></a>
    <span class="keyword">else</span> <span class="punctuation">{</span>
</code></pre>
<p>We get the text of the active editor as string. If we have
case-insensitive search, we transform the text to lower case.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">let</span> <span id="18588" data-toggle="tooltip" data-title="vscode.TextDocument">doc</span> <span class="punctuation">=</span> <a href="commands.html#18148"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span>
        <span class="keyword">let</span> <span id="18623" data-toggle="tooltip" data-title="string">docText</span> <span class="punctuation">=</span> <a href="commands.html#4112"><span data-toggle="tooltip" data-title="boolean">searchCaseSensitive</span></a> <span class="punctuation">?</span>
            <a href="commands.html#18588"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">:</span> <a href="commands.html#18588"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
</code></pre>
<p>Next we determine the search target. It is also transformed to
lower case, if search is case-insensitive.</p>
<pre class="syntaxhighlight"><code>        <span class="keyword">let</span> <span id="18882" data-toggle="tooltip" data-title="string">target</span> <span class="punctuation">=</span> <a href="commands.html#4112"><span data-toggle="tooltip" data-title="boolean">searchCaseSensitive</span></a> <span class="punctuation">?</span>
            <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a> <span class="punctuation">:</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <a href="commands.html#18148"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span> <span class="punctuation">=</span> <a href="commands.html#18174"><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(callbackfn: (value: vscode.Selection, index: number, array: vscode.Selection[]) =&gt; U, thisArg?: any) =&gt; U[]">map</span><span class="punctuation">(</span><span id="19013" data-toggle="tooltip" data-title="vscode.Selection">sel</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
</code></pre>
<p>This is the actual search that is performed for each cursor
position. The lambda function returns a new selection for each
active cursor.</p>
<pre class="syntaxhighlight"><code>            <span class="keyword">let</span> <span id="19259" data-toggle="tooltip" data-title="number">startOffs</span> <span class="punctuation">=</span> <a href="commands.html#18588"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: vscode.Position) =&gt; number">offsetAt</span><span class="punctuation">(</span><a href="commands.html#19013"><span data-toggle="tooltip" data-title="vscode.Selection">sel</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">active</span><span class="punctuation">)</span>
</code></pre>
<p>Depending on the search direction we find either the
first or the last match from the start offset.</p>
<pre class="syntaxhighlight"><code>            <span class="keyword">let</span> <span id="19481" data-toggle="tooltip" data-title="number">offs</span> <span class="punctuation">=</span> <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">?</span>
                <a href="commands.html#18623"><span data-toggle="tooltip" data-title="string">docText</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">lastIndexOf</span><span class="punctuation">(</span><a href="commands.html#18882"><span data-toggle="tooltip" data-title="string">target</span></a><span class="punctuation">,</span> <a href="commands.html#19259"><span data-toggle="tooltip" data-title="number">startOffs</span></a> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">:</span>
                <a href="commands.html#18623"><span data-toggle="tooltip" data-title="string">docText</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">indexOf</span><span class="punctuation">(</span><a href="commands.html#18882"><span data-toggle="tooltip" data-title="string">target</span></a><span class="punctuation">,</span> <a href="commands.html#19259"><span data-toggle="tooltip" data-title="number">startOffs</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#19481"><span data-toggle="tooltip" data-title="number">offs</span></a> <span class="punctuation">&lt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4145"><span data-toggle="tooltip" data-title="boolean">searchWrapAround</span></a><span class="punctuation">)</span>
</code></pre>
<p>If search string was not found but <code>wrapAround</code> argument
was set, we try to find the search string from beginning
or end of the document. If that fails too, we return
the original selection and the cursor will not move.</p>
<pre class="syntaxhighlight"><code>                    <a href="commands.html#19481"><span data-toggle="tooltip" data-title="number">offs</span></a> <span class="punctuation">=</span> <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">?</span>
                        <a href="commands.html#18623"><span data-toggle="tooltip" data-title="string">docText</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">lastIndexOf</span><span class="punctuation">(</span><a href="commands.html#18882"><span data-toggle="tooltip" data-title="string">target</span></a><span class="punctuation">)</span> <span class="punctuation">:</span>
                        <a href="commands.html#18623"><span data-toggle="tooltip" data-title="string">docText</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">indexOf</span><span class="punctuation">(</span><a href="commands.html#18882"><span data-toggle="tooltip" data-title="string">target</span></a><span class="punctuation">)</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#19481"><span data-toggle="tooltip" data-title="number">offs</span></a> <span class="punctuation">&lt;</span> <span class="number">0</span><span class="punctuation">)</span>
                    <span class="keyword">return</span> <a href="commands.html#19013"><span data-toggle="tooltip" data-title="vscode.Selection">sel</span></a>
            <span class="punctuation">}</span>
</code></pre>
<p>If search was successful, we return a new selection to highlight
it. First, we find the start and end position of the match.</p>
<pre class="syntaxhighlight"><code>            <span class="keyword">let</span> <span id="20491" data-toggle="tooltip" data-title="number">len</span> <span class="punctuation">=</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span>
            <span class="keyword">let</span> <span id="20534" data-toggle="tooltip" data-title="vscode.Position">start</span> <span class="punctuation">=</span> <a href="commands.html#18588"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(offset: number) =&gt; vscode.Position">positionAt</span><span class="punctuation">(</span><a href="commands.html#19481"><span data-toggle="tooltip" data-title="number">offs</span></a><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="20580" data-toggle="tooltip" data-title="vscode.Position">end</span> <span class="punctuation">=</span> <a href="commands.html#18588"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(offset: number) =&gt; vscode.Position">positionAt</span><span class="punctuation">(</span><a href="commands.html#19481"><span data-toggle="tooltip" data-title="number">offs</span></a> <span class="punctuation">+</span> <a href="commands.html#20491"><span data-toggle="tooltip" data-title="number">len</span></a><span class="punctuation">)</span>
</code></pre>
<p>If the search direction is backwards, we flip the active and
anchor positions. Normally, the anchor is set to the start and
cursor to the end. Finally, we check if the <code>selectTillMatch</code>
argument is set. If so, we move only the active cursor position
and leave the selection start (anchor) as-is.</p>
<pre class="syntaxhighlight"><code>            <span class="keyword">let</span> <span class="punctuation">[</span><span id="21042" data-toggle="tooltip" data-title="vscode.Position">active</span><span class="punctuation">,</span> <span id="21049" data-toggle="tooltip" data-title="vscode.Position">anchor</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">?</span>
                <span class="punctuation">[</span><a href="commands.html#20534"><span data-toggle="tooltip" data-title="vscode.Position">start</span></a><span class="punctuation">,</span> <a href="commands.html#20580"><span data-toggle="tooltip" data-title="vscode.Position">end</span></a><span class="punctuation">]</span> <span class="punctuation">:</span>
                <span class="punctuation">[</span><a href="commands.html#20580"><span data-toggle="tooltip" data-title="vscode.Position">end</span></a><span class="punctuation">,</span> <a href="commands.html#20534"><span data-toggle="tooltip" data-title="vscode.Position">start</span></a><span class="punctuation">]</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4225"><span data-toggle="tooltip" data-title="boolean">searchSelectTillMatch</span></a><span class="punctuation">)</span>
                <a href="commands.html#21049"><span data-toggle="tooltip" data-title="vscode.Position">anchor</span></a> <span class="punctuation">=</span> <a href="commands.html#19013"><span data-toggle="tooltip" data-title="vscode.Selection">sel</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">anchor</span>
            <span class="keyword">return</span> <span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Selection">Selection</span><span class="punctuation">(</span><a href="commands.html#21049"><span data-toggle="tooltip" data-title="vscode.Position">anchor</span></a><span class="punctuation">,</span> <a href="commands.html#21042"><span data-toggle="tooltip" data-title="vscode.Position">active</span></a><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <a href="commands.html#18148"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range: vscode.Range, revealType?: vscode.TextEditorRevealType | undefined) =&gt; void">revealRange</span><span class="punctuation">(</span><a href="commands.html#18148"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="accepting-search">Accepting Search</h3>
<p>Accepting the search resets the mode variables. Additionally, if
<code>typeAfterAccept</code> argument is set we run the given normal mode commands.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="21337" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">acceptSearch</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">await</span> <a href="commands.html#14214"><span class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setSearching</span></a><span class="punctuation">(</span><span class="keyword">false</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4260"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterAccept</span></a><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">(</span><span class="punctuation">{</span> <span id="21652" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <a href="commands.html#4260"><span data-toggle="tooltip" data-title="string">searchTypeAfterAccept</span></a> <span class="punctuation">}</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="canceling-search">Canceling Search</h3>
<p>Canceling search just resets state, and moves the cursor back to the starting
position.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="21686" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">cancelSearch</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">await</span> <a href="commands.html#14214"><span class="member" data-toggle="tooltip" data-title="(value: boolean) =&gt; Promise&lt;void&gt;">setSearching</span></a><span class="punctuation">(</span><span class="keyword">false</span><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="21940" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#21940"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="commands.html#21940"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span> <span class="punctuation">=</span> <a href="commands.html#3994"><span data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span></a>
            <a href="commands.html#21940"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range: vscode.Range, revealType?: vscode.TextEditorRevealType | undefined) =&gt; void">revealRange</span><span class="punctuation">(</span><a href="commands.html#21940"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="modifying-search-string">Modifying Search String</h3>
<p>Since we cannot capture the backspace character in normal mode, we have to
hook it some other way. We define a command <code>modaledit.deleteCharFromSearch</code>
which deletes the last character from the search string. This command can
then be bound to backspace using the standard keybindings. We only run the
command, if the <code>modaledit.searching</code> context is set. Below is an excerpt
of the default keybindings defined in <code>package.json</code>.</p>

<pre class="syntaxhighlight"><code>{
    <span class="string">"key"</span>: <span class="string">"Backspace"</span>,
    <span class="string">"command"</span>: <span class="string">"modaledit.deleteCharFromSearch"</span>,
    <span class="string">"when"</span>: <span class="string">"editorTextFocus &amp;&amp; modaledit.searching"</span>
}
</code></pre>
<p>Note that we need to also update the status bar to show the modified search
string. The <code>onType</code> callback that normally handles this is not getting
called when this command is invoked.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="22129" class="member" data-toggle="tooltip" data-title="() =&gt; void">deleteCharFromSearch</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="23035" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#23035"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a> <span class="punctuation">&amp;&amp;</span> <a href="commands.html#3907"><span data-toggle="tooltip" data-title="boolean">searching</span></a> <span class="punctuation">&amp;&amp;</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">&gt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a> <span class="punctuation">=</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number | undefined, end?: number | undefined) =&gt; string">slice</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">)</span>
        <a href="commands.html#17509"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, selections: vscode.Selection[]) =&gt; void">highlightMatches</span></a><span class="punctuation">(</span><a href="commands.html#23035"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#3994"><span data-toggle="tooltip" data-title="vscode.Selection[]">searchStartSelections</span></a><span class="punctuation">)</span>
        <a href="commands.html#12019"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor | undefined, help?: string | undefined) =&gt; void">updateStatusBar</span></a><span class="punctuation">(</span><a href="commands.html#23035"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h3 id="finding-previous-and-next-match">Finding Previous and Next Match</h3>
<p>Using the <code>highlightMatches</code> function finding next and previous match is a
relatively simple task. We basically just restart the search from
the current cursor position(s).</p>
<p>We also check whether the search parameters include <code>typeBeforeNextMatch</code> or
<code>typeAfterNextMatch</code> argument. If so, we invoke the user-specified commands
before and/or after we jump to the next match.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="23305" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">nextMatch</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="23820" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#23820"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a> <span class="punctuation">&amp;&amp;</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4307"><span data-toggle="tooltip" data-title="string | undefined">searchTypeBeforeNextMatch</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">(</span><span class="punctuation">{</span> <span id="23971" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <a href="commands.html#4307"><span data-toggle="tooltip" data-title="string">searchTypeBeforeNextMatch</span></a> <span class="punctuation">}</span><span class="punctuation">)</span>
        <a href="commands.html#17509"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, selections: vscode.Selection[]) =&gt; void">highlightMatches</span></a><span class="punctuation">(</span><a href="commands.html#23820"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#23820"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4358"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterNextMatch</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">(</span><span class="punctuation">{</span> <span id="24134" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <a href="commands.html#4358"><span data-toggle="tooltip" data-title="string">searchTypeAfterNextMatch</span></a> <span class="punctuation">}</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>When finding the previous match we flip the search direction but otherwise do
the same routine as in the previous function.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="24178" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">previousMatch</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="24378" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#24378"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a> <span class="punctuation">&amp;&amp;</span> <a href="commands.html#3968"><span data-toggle="tooltip" data-title="string">searchString</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4408"><span data-toggle="tooltip" data-title="string | undefined">searchTypeBeforePreviousMatch</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">(</span><span class="punctuation">{</span> <span id="24533" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <a href="commands.html#4408"><span data-toggle="tooltip" data-title="string">searchTypeBeforePreviousMatch</span></a> <span class="punctuation">}</span><span class="punctuation">)</span>
        <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">=</span> <span class="punctuation">!</span><a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a>
        <a href="commands.html#17509"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, selections: vscode.Selection[]) =&gt; void">highlightMatches</span></a><span class="punctuation">(</span><a href="commands.html#24378"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#24378"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span><span class="punctuation">)</span>
        <a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a> <span class="punctuation">=</span> <span class="punctuation">!</span><a href="commands.html#4083"><span data-toggle="tooltip" data-title="boolean">searchBackwards</span></a>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#4463"><span data-toggle="tooltip" data-title="string | undefined">searchTypeAfterPreviousMatch</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="commands.html#27441"><span class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span></a><span class="punctuation">(</span><span class="punctuation">{</span> <span id="24792" data-toggle="tooltip" data-title="string">keys</span><span class="punctuation">:</span> <a href="commands.html#4463"><span data-toggle="tooltip" data-title="string">searchTypeAfterPreviousMatch</span></a> <span class="punctuation">}</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="bookmarks">Bookmarks</h2>
<p>Defining a bookmark is simple. We just store the cursor location and file in
a <code>Bookmark</code> object, and store it in the <code>bookmarks</code> array.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="24840" class="member" data-toggle="tooltip" data-title="(args?: BookmarkArgs | undefined) =&gt; void">defineBookmark</span><span class="punctuation">(</span><span id="25043" data-toggle="tooltip" data-title="BookmarkArgs | undefined">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="commands.html#1002"><span class="typename" data-toggle="tooltip" data-title="BookmarkArgs">BookmarkArgs</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="25074" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#25074"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="25146" data-toggle="tooltip" data-title="vscode.TextDocument">document</span> <span class="punctuation">=</span> <a href="commands.html#25074"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span>
        <span class="keyword">let</span> <span id="25186" data-toggle="tooltip" data-title="vscode.Position">position</span> <span class="punctuation">=</span> <a href="commands.html#25074"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">active</span>
        <a href="commands.html#4591"><span data-toggle="tooltip" data-title="Bookmark[]">bookmarks</span></a><span class="punctuation">[</span><a href="commands.html#25043"><span data-toggle="tooltip" data-title="BookmarkArgs | undefined">args</span></a><span class="punctuation">?.</span><a href="commands.html#1267"><span data-toggle="tooltip" data-title="number | undefined">bookmark</span></a> <span class="punctuation">||</span> <span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span id="25265" data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">,</span> <span id="25275" data-toggle="tooltip" data-title="vscode.Position">position</span> <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Jumping to bookmark is also easy, just call the <code>changeSelection</code> function
we already defined. It makes sure that selection is visible.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="25296" class="member" data-toggle="tooltip" data-title="(args?: BookmarkArgs | undefined) =&gt; Promise&lt;void&gt;">goToBookmark</span><span class="punctuation">(</span><span id="25480" data-toggle="tooltip" data-title="BookmarkArgs | undefined">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="commands.html#1002"><span class="typename" data-toggle="tooltip" data-title="BookmarkArgs">BookmarkArgs</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="25526" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <a href="commands.html#25480"><span data-toggle="tooltip" data-title="BookmarkArgs | undefined">args</span></a><span class="punctuation">?.</span><a href="commands.html#1267"><span data-toggle="tooltip" data-title="number | undefined">bookmark</span></a> <span class="punctuation">||</span> <span class="number">0</span>
    <span class="keyword">let</span> <span id="25559" data-toggle="tooltip" data-title="Bookmark">bm</span> <span class="punctuation">=</span> <a href="commands.html#4591"><span data-toggle="tooltip" data-title="Bookmark[]">bookmarks</span></a><span class="punctuation">[</span><a href="commands.html#25526"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#25559"><span data-toggle="tooltip" data-title="Bookmark">bm</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (document: vscode.TextDocument, column?: vscode.ViewColumn | undefined, preserveFocus?: boolean | undefined): Thenable&lt;vscode.TextEditor&gt;; (document: vscode.TextDocument, options?: vscode.TextDocumentShowOptions | undefined): Thenable&lt;...&gt;; (uri: vscode.Uri, options?: vscode.TextDocumentShowOptions | undefined): T...">showTextDocument</span><span class="punctuation">(</span><a href="commands.html#25559"><span data-toggle="tooltip" data-title="Bookmark">bm</span></a><span class="punctuation">.</span><a href="commands.html#1317"><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span></a><span class="punctuation">)</span>
        <span class="keyword">let</span> <span id="25664" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#25664"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
            <a href="commands.html#25798"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, anchor: vscode.Position, active: vscode.Position) =&gt; void">changeSelection</span></a><span class="punctuation">(</span><a href="commands.html#25664"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#25559"><span data-toggle="tooltip" data-title="Bookmark">bm</span></a><span class="punctuation">.</span><a href="commands.html#1352"><span data-toggle="tooltip" data-title="vscode.Position">position</span></a><span class="punctuation">,</span> <a href="commands.html#25559"><span data-toggle="tooltip" data-title="Bookmark">bm</span></a><span class="punctuation">.</span><a href="commands.html#1352"><span data-toggle="tooltip" data-title="vscode.Position">position</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>This helper function changes the selection range in the active editor. It
also makes sure that the selection is visible.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="25798" class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, anchor: vscode.Position, active: vscode.Position) =&gt; void">changeSelection</span><span class="punctuation">(</span><span id="25964" data-toggle="tooltip" data-title="vscode.TextEditor">editor</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditor">TextEditor</span><span class="punctuation">,</span> <span id="25990" data-toggle="tooltip" data-title="vscode.Position">anchor</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Position">Position</span><span class="punctuation">,</span>
    <span id="26015" data-toggle="tooltip" data-title="vscode.Position">active</span><span class="punctuation">:</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.Position">Position</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="commands.html#25964"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span> <span class="punctuation">=</span> <span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Selection">Selection</span><span class="punctuation">(</span><a href="commands.html#25990"><span data-toggle="tooltip" data-title="vscode.Position">anchor</span></a><span class="punctuation">,</span> <a href="commands.html#26015"><span data-toggle="tooltip" data-title="vscode.Position">active</span></a><span class="punctuation">)</span>
    <a href="commands.html#25964"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range: vscode.Range, revealType?: vscode.TextEditorRevealType | undefined) =&gt; void">revealRange</span><span class="punctuation">(</span><a href="commands.html#25964"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="quick-snippets">Quick Snippets</h2>
<p>Supporting quick snippets is also a pleasantly simple job. First we implement
the <code>modaledit.fillSnippetArgs</code> command, which replaces (multi-)selection
ranges with <code>$1</code>, <code>$2</code>, ...</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="26153" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">fillSnippetArgs</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="26442" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#26442"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="26514" data-toggle="tooltip" data-title="vscode.Selection[]">sel</span> <span class="punctuation">=</span> <a href="commands.html#26442"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection[]">selections</span>
        <span class="keyword">await</span> <a href="commands.html#26442"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callback: (editBuilder: vscode.TextEditorEdit) =&gt; void, options?: { undoStopBefore: boolean; undoStopAfter: boolean; } | undefined) =&gt; Thenable&lt;boolean&gt;">edit</span><span class="punctuation">(</span><span id="26566" data-toggle="tooltip" data-title="vscode.TextEditorEdit">eb</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="26595" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="commands.html#26595"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="commands.html#26514"><span data-toggle="tooltip" data-title="vscode.Selection[]">sel</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <a href="commands.html#26595"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span>
                <a href="commands.html#26566"><span data-toggle="tooltip" data-title="vscode.TextEditorEdit">eb</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(location: vscode.Selection | vscode.Range | vscode.Position, value: string) =&gt; void">replace</span><span class="punctuation">(</span><a href="commands.html#26514"><span data-toggle="tooltip" data-title="vscode.Selection[]">sel</span></a><span class="punctuation">[</span><a href="commands.html#26595"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;$&quot;</span> <span class="punctuation">+</span> <span class="punctuation">(</span><a href="commands.html#26595"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">+</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">}</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>Defining a snippet just puts the selection into an array.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="26696" class="member" data-toggle="tooltip" data-title="(args?: QuickSnippetArgs | undefined) =&gt; void">defineQuickSnippet</span><span class="punctuation">(</span><span id="26798" data-toggle="tooltip" data-title="QuickSnippetArgs | undefined">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="commands.html#1386"><span class="typename" data-toggle="tooltip" data-title="QuickSnippetArgs">QuickSnippetArgs</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="26833" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#26833"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
        <a href="commands.html#4694"><span data-toggle="tooltip" data-title="string[]">quickSnippets</span></a><span class="punctuation">[</span><a href="commands.html#26798"><span data-toggle="tooltip" data-title="QuickSnippetArgs | undefined">args</span></a><span class="punctuation">?.</span><a href="commands.html#1582"><span data-toggle="tooltip" data-title="number | undefined">snippet</span></a> <span class="punctuation">||</span> <span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">=</span>
            <a href="commands.html#26833"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><a href="commands.html#26833"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Inserting a snippet is done as easily with the built-in command. We enter
insert mode automatically before snippet is expanded.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="26993" class="member" data-toggle="tooltip" data-title="(args?: QuickSnippetArgs | undefined) =&gt; Promise&lt;void&gt;">insertQuickSnippet</span><span class="punctuation">(</span><span id="27176" data-toggle="tooltip" data-title="QuickSnippetArgs | undefined">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <a href="commands.html#1386"><span class="typename" data-toggle="tooltip" data-title="QuickSnippetArgs">QuickSnippetArgs</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="27226" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <a href="commands.html#27176"><span data-toggle="tooltip" data-title="QuickSnippetArgs | undefined">args</span></a><span class="punctuation">?.</span><a href="commands.html#1582"><span data-toggle="tooltip" data-title="number | undefined">snippet</span></a> <span class="punctuation">||</span> <span class="number">0</span>
    <span class="keyword">let</span> <span id="27258" data-toggle="tooltip" data-title="string">snippet</span> <span class="punctuation">=</span> <a href="commands.html#4694"><span data-toggle="tooltip" data-title="string[]">quickSnippets</span></a><span class="punctuation">[</span><a href="commands.html#27226"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#27258"><span data-toggle="tooltip" data-title="string">snippet</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="commands.html#10244"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">enterInsert</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><span class="string">&quot;editor.action.insertSnippet&quot;</span><span class="punctuation">,</span>
            <span class="punctuation">{</span> <span id="27420" data-toggle="tooltip" data-title="string">snippet</span> <span class="punctuation">}</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="invoking-commands-via-key-bindings">Invoking Commands via Key Bindings</h2>
<p>The last command runs normal mode commands throught their key bindings.
Implementing that is as easy as calling the keyboard handler.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="27441" class="member" data-toggle="tooltip" data-title="(args: TypeNormalKeysArgs) =&gt; Promise&lt;void&gt;">typeNormalKeys</span><span class="punctuation">(</span><span id="27673" data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span><span class="punctuation">:</span> <a href="commands.html#1606"><span class="typename" data-toggle="tooltip" data-title="TypeNormalKeysArgs">TypeNormalKeysArgs</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="commands.html#27673"><span data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span></a> <span class="punctuation">!==</span> <span class="string">&#039;object&#039;</span> <span class="punctuation">||</span> <span class="keyword">typeof</span> <span class="punctuation">(</span><a href="commands.html#27673"><span data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#1801"><span data-toggle="tooltip" data-title="string">keys</span></a><span class="punctuation">)</span> <span class="punctuation">!==</span> <span class="string">&#039;string&#039;</span><span class="punctuation">)</span>
        <span class="keyword">throw</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span><span class="string">`${</span><a href="commands.html#5957"><span data-toggle="tooltip" data-title="&quot;modaledit.typeNormalKeys&quot;">typeNormalKeysId</span></a><span class="string">}: Invalid args: ${</span><span class="typename" data-toggle="tooltip" data-title="JSON">JSON</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (value: any, replacer?: ((this: any, key: string, value: any) =&gt; any) | undefined, space?: string | number | undefined): string; (value: any, replacer?: (string | number)[] | null | undefined, space?: string | ... 1 more ... | undefined): string; }">stringify</span><span class="punctuation">(</span><a href="commands.html#27673"><span data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span></a><span class="punctuation">)</span><span class="string">}`</span><span class="punctuation">)</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="27882" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="commands.html#27882"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="commands.html#27673"><span data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#1801"><span data-toggle="tooltip" data-title="string">keys</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <a href="commands.html#27882"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="commands.html#8936"><span class="member" data-toggle="tooltip" data-title="(key: string, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">runActionForKey</span></a><span class="punctuation">(</span><a href="commands.html#27673"><span data-toggle="tooltip" data-title="TypeNormalKeysArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#1801"><span data-toggle="tooltip" data-title="string">keys</span></a><span class="punctuation">[</span><a href="commands.html#27882"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="advanced-selection-command">Advanced Selection Command</h2>
<p>For selecting ranges of text between two characters (inside parenthesis, for
example) we add the <code>modaledit.selectBetween</code> command.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="27971" class="member" data-toggle="tooltip" data-title="(args: SelectBetweenArgs) =&gt; void">selectBetween</span><span class="punctuation">(</span><span id="28186" data-toggle="tooltip" data-title="SelectBetweenArgs">args</span><span class="punctuation">:</span> <a href="commands.html#1822"><span class="typename" data-toggle="tooltip" data-title="SelectBetweenArgs">SelectBetweenArgs</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="28221" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#28221"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span>
        <span class="keyword">return</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a> <span class="punctuation">!==</span> <span class="string">&#039;object&#039;</span><span class="punctuation">)</span>
        <span class="keyword">throw</span> <span class="typename" data-toggle="tooltip" data-title="ErrorConstructor">Error</span><span class="punctuation">(</span><span class="string">`${</span><a href="commands.html#6010"><span data-toggle="tooltip" data-title="&quot;modaledit.selectBetween&quot;">selectBetweenId</span></a><span class="string">}: Invalid args: ${</span><span class="typename" data-toggle="tooltip" data-title="JSON">JSON</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (value: any, replacer?: ((this: any, key: string, value: any) =&gt; any) | undefined, space?: string | number | undefined): string; (value: any, replacer?: (string | number)[] | null | undefined, space?: string | ... 1 more ... | undefined): string; }">stringify</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="never">args</span></a><span class="punctuation">)</span><span class="string">}`</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="28421" data-toggle="tooltip" data-title="vscode.TextDocument">doc</span> <span class="punctuation">=</span> <a href="commands.html#28221"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span>
</code></pre>
<p>Get position of cursor and anchor. If <code>from</code> parameter is missing, anchor
position will be used as the selection start. If <code>to</code> parameter is
missing, the cursor position is where selection ends. <code>fromOffs</code> and
<code>toOffs</code> variables' default values are set accordingly.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">let</span> <span id="28770" data-toggle="tooltip" data-title="vscode.Position">cursorPos</span> <span class="punctuation">=</span> <a href="commands.html#28221"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">active</span>
    <span class="keyword">let</span> <span id="28815" data-toggle="tooltip" data-title="vscode.Position">anchorPos</span> <span class="punctuation">=</span> <a href="commands.html#28221"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">anchor</span>
    <span class="keyword">let</span> <span id="28860" data-toggle="tooltip" data-title="number">cursorOffs</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: vscode.Position) =&gt; number">offsetAt</span><span class="punctuation">(</span><a href="commands.html#28770"><span data-toggle="tooltip" data-title="vscode.Position">cursorPos</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="28906" data-toggle="tooltip" data-title="number">anchorOffs</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: vscode.Position) =&gt; number">offsetAt</span><span class="punctuation">(</span><a href="commands.html#28815"><span data-toggle="tooltip" data-title="vscode.Position">anchorPos</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="28952" data-toggle="tooltip" data-title="number">fromOffs</span> <span class="punctuation">=</span> <a href="commands.html#28906"><span data-toggle="tooltip" data-title="number">anchorOffs</span></a>
    <span class="keyword">let</span> <span id="28983" data-toggle="tooltip" data-title="number">toOffs</span> <span class="punctuation">=</span> <a href="commands.html#28860"><span data-toggle="tooltip" data-title="number">cursorOffs</span></a>
</code></pre>
<p>Next we determine the search range. The <code>startOffs</code> marks the starting
offset and <code>endOffs</code> the end. Depending on the specified scope these
variables are either set to start/end of the current line or the whole
document.</p>
<pre class="syntaxhighlight"><code>    <span class="keyword">let</span> <span id="29283" data-toggle="tooltip" data-title="vscode.Position">startPos</span> <span class="punctuation">=</span> <span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Position">Position</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2999"><span data-toggle="tooltip" data-title="boolean">docScope</span></a> <span class="punctuation">?</span> <span class="number">0</span> <span class="punctuation">:</span> <a href="commands.html#28770"><span data-toggle="tooltip" data-title="vscode.Position">cursorPos</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">line</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="29362" data-toggle="tooltip" data-title="vscode.Position">endPos</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (line: number): vscode.TextLine; (position: vscode.Position): vscode.TextLine; }">lineAt</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2999"><span data-toggle="tooltip" data-title="boolean">docScope</span></a> <span class="punctuation">?</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">lineCount</span> <span class="punctuation">-</span> <span class="number">1</span> <span class="punctuation">:</span> <a href="commands.html#28770"><span data-toggle="tooltip" data-title="vscode.Position">cursorPos</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">line</span><span class="punctuation">)</span>
        <span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Range">range</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">end</span>
    <span class="keyword">let</span> <span id="29463" data-toggle="tooltip" data-title="number">startOffs</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: vscode.Position) =&gt; number">offsetAt</span><span class="punctuation">(</span><a href="commands.html#29283"><span data-toggle="tooltip" data-title="vscode.Position">startPos</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="29507" data-toggle="tooltip" data-title="number">endOffs</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(position: vscode.Position) =&gt; number">offsetAt</span><span class="punctuation">(</span><a href="commands.html#29362"><span data-toggle="tooltip" data-title="vscode.Position">endPos</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2927"><span data-toggle="tooltip" data-title="boolean">regex</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a>
            <span class="keyword">let</span> <span id="29638" data-toggle="tooltip" data-title="string">text</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Range">Range</span><span class="punctuation">(</span><a href="commands.html#29283"><span data-toggle="tooltip" data-title="vscode.Position">startPos</span></a><span class="punctuation">,</span> <a href="commands.html#28770"><span data-toggle="tooltip" data-title="vscode.Position">cursorPos</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="29713" data-toggle="tooltip" data-title="RegExp">re</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">,</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2971"><span data-toggle="tooltip" data-title="boolean">caseSensitive</span></a> <span class="punctuation">?</span> <span class="string">&quot;g&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;gi&quot;</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="29790" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="RegExpExecArray">RegExpExecArray</span> <span class="punctuation">|</span> <span class="keyword">null</span> <span class="punctuation">=</span> <span class="keyword">null</span>
            <span class="keyword">while</span> <span class="punctuation">(</span><span class="punctuation">(</span><a href="commands.html#29790"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a> <span class="punctuation">=</span> <a href="commands.html#29713"><span data-toggle="tooltip" data-title="RegExp">re</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="commands.html#29638"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a> <span class="punctuation">+</span> <a href="commands.html#29790"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span>
                    <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2947"><span data-toggle="tooltip" data-title="boolean">inclusive</span></a> <span class="punctuation">?</span> <span class="number">0</span> <span class="punctuation">:</span> <a href="commands.html#29790"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">)</span>
            <span class="punctuation">}</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#29507"><span data-toggle="tooltip" data-title="number">endOffs</span></a>
            <span class="keyword">let</span> <span id="30093" data-toggle="tooltip" data-title="string">text</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Range">Range</span><span class="punctuation">(</span><a href="commands.html#28770"><span data-toggle="tooltip" data-title="vscode.Position">cursorPos</span></a><span class="punctuation">,</span> <a href="commands.html#29362"><span data-toggle="tooltip" data-title="vscode.Position">endPos</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="30166" data-toggle="tooltip" data-title="RegExp">re</span> <span class="punctuation">=</span> <span class="keyword">new</span> <span class="typename" data-toggle="tooltip" data-title="RegExpConstructor">RegExp</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">,</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2971"><span data-toggle="tooltip" data-title="boolean">caseSensitive</span></a> <span class="punctuation">?</span> <span data-toggle="tooltip" data-title="undefined">undefined</span> <span class="punctuation">:</span> <span class="string">&quot;i&quot;</span><span class="punctuation">)</span>
            <span class="keyword">let</span> <span id="30246" data-toggle="tooltip" data-title="RegExpExecArray | null">match</span> <span class="punctuation">=</span> <a href="commands.html#30166"><span data-toggle="tooltip" data-title="RegExp">re</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(string: string) =&gt; RegExpExecArray | null">exec</span><span class="punctuation">(</span><a href="commands.html#30093"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#30246"><span data-toggle="tooltip" data-title="RegExpExecArray | null">match</span></a><span class="punctuation">)</span>
                <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#28860"><span data-toggle="tooltip" data-title="number">cursorOffs</span></a> <span class="punctuation">+</span> <a href="commands.html#30246"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">index</span> <span class="punctuation">+</span>
                    <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2947"><span data-toggle="tooltip" data-title="boolean">inclusive</span></a> <span class="punctuation">?</span> <a href="commands.html#30246"><span data-toggle="tooltip" data-title="RegExpExecArray">match</span></a><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="30448" data-toggle="tooltip" data-title="string">text</span> <span class="punctuation">=</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="keyword">new</span> <a href="commands.html#264"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Range">Range</span><span class="punctuation">(</span><a href="commands.html#29283"><span data-toggle="tooltip" data-title="vscode.Position">startPos</span></a><span class="punctuation">,</span> <a href="commands.html#29362"><span data-toggle="tooltip" data-title="vscode.Position">endPos</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2971"><span data-toggle="tooltip" data-title="boolean">caseSensitive</span></a><span class="punctuation">)</span>
            <a href="commands.html#30448"><span data-toggle="tooltip" data-title="string">text</span></a> <span class="punctuation">=</span> <a href="commands.html#30448"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#30448"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">lastIndexOf</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2971"><span data-toggle="tooltip" data-title="boolean">caseSensitive</span></a> <span class="punctuation">?</span>
                <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a> <span class="punctuation">:</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="commands.html#28860"><span data-toggle="tooltip" data-title="number">cursorOffs</span></a> <span class="punctuation">-</span> <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a><span class="punctuation">)</span>
            <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">&lt;</span> <span class="number">0</span> <span class="punctuation">?</span> <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a> <span class="punctuation">:</span>
                <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a> <span class="punctuation">+</span> <a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a> <span class="punctuation">+</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2947"><span data-toggle="tooltip" data-title="boolean">inclusive</span></a> <span class="punctuation">?</span> <span class="number">0</span> <span class="punctuation">:</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2893"><span data-toggle="tooltip" data-title="string">from</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#30448"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(searchString: string, position?: number | undefined) =&gt; number">indexOf</span><span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2971"><span data-toggle="tooltip" data-title="boolean">caseSensitive</span></a> <span class="punctuation">?</span>
                <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a> <span class="punctuation">:</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> <a href="commands.html#28860"><span data-toggle="tooltip" data-title="number">cursorOffs</span></a> <span class="punctuation">-</span> <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a><span class="punctuation">)</span>
            <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">=</span> <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">&lt;</span> <span class="number">0</span> <span class="punctuation">?</span> <a href="commands.html#29507"><span data-toggle="tooltip" data-title="number">endOffs</span></a> <span class="punctuation">:</span>
                <a href="commands.html#29463"><span data-toggle="tooltip" data-title="number">startOffs</span></a> <span class="punctuation">+</span> <a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a> <span class="punctuation">+</span> <span class="punctuation">(</span><a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2947"><span data-toggle="tooltip" data-title="boolean">inclusive</span></a> <span class="punctuation">?</span> <a href="commands.html#28186"><span data-toggle="tooltip" data-title="SelectBetweenArgs">args</span></a><span class="punctuation">.</span><a href="commands.html#2911"><span data-toggle="tooltip" data-title="string">to</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <a href="commands.html#25798"><span class="member" data-toggle="tooltip" data-title="(editor: vscode.TextEditor, anchor: vscode.Position, active: vscode.Position) =&gt; void">changeSelection</span></a><span class="punctuation">(</span><a href="commands.html#28221"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">,</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(offset: number) =&gt; vscode.Position">positionAt</span><span class="punctuation">(</span><a href="commands.html#28952"><span data-toggle="tooltip" data-title="number">fromOffs</span></a><span class="punctuation">)</span><span class="punctuation">,</span> <a href="commands.html#28421"><span data-toggle="tooltip" data-title="vscode.TextDocument">doc</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(offset: number) =&gt; vscode.Position">positionAt</span><span class="punctuation">(</span><a href="commands.html#28983"><span data-toggle="tooltip" data-title="number">toOffs</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="repeat-last-change-command">Repeat Last Change Command</h2>
<p>The <code>repeatLastChange</code> command runs the key sequence stored in <code>lastChange</code>
variable. Since the command inevitably causes text in the editor to change
(which causes the <code>textChanged</code> flag to go high), it has to reset the current
key sequence to prevent the <code>lastChange</code> variable from being overwritten next
time the user presses a key.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="31259" class="member" data-toggle="tooltip" data-title="() =&gt; Promise&lt;void&gt;">repeatLastChange</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="31734" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="commands.html#31734"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="commands.html#5048"><span data-toggle="tooltip" data-title="string[]">lastChange</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <a href="commands.html#31734"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="commands.html#8936"><span class="member" data-toggle="tooltip" data-title="(key: string, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">runActionForKey</span></a><span class="punctuation">(</span><a href="commands.html#5048"><span data-toggle="tooltip" data-title="string[]">lastChange</span></a><span class="punctuation">[</span><a href="commands.html#31734"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <span class="keyword">false</span><span class="punctuation">)</span>
    <a href="commands.html#4973"><span data-toggle="tooltip" data-title="string[]">currentKeySequence</span></a> <span class="punctuation">=</span> <a href="commands.html#5048"><span data-toggle="tooltip" data-title="string[]">lastChange</span></a>
<span class="punctuation">}</span>
</code></pre>

        
    </div>
            <div class="stickypane">
                
    <div class="pagemenu">
        <h3>On This Page</h3>
            <ul class="pagetree">
                
            </ul>
    </div>
                
            </div>
        </div>
    </div>
    <script src="../js/main.js"></script>
    
</body>
</html>