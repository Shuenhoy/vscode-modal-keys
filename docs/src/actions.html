
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ModalEdit - Actions</title>
    <link rel="icon" type="image/icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/main.css" />
    
    
</head>
<body>
    
    <div class="navbar">
        <div class="navmenu">
            
    <a class="title enabled" href="../index.html">
        <img src="../images/escape.svg" />
        <span>ModalEdit</span>
    </a>
    <a class="enabled" href="https://marketplace.visualstudio.com/items?itemName=johtela.vscode-modaledit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z"/></svg>
        <span>Download</span>
    </a>
    <a class="enabled" href="https://github.com/johtela/vscode-modaledit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
        <span>GitHub</span>
    </a>
    <a class="enabled" href="../LICENSE.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zM64 72c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8V72zm0 64c0-4.42 3.58-8 8-8h80c4.42 0 8 3.58 8 8v16c0 4.42-3.58 8-8 8H72c-4.42 0-8-3.58-8-8v-16zm192.81 248H304c8.84 0 16 7.16 16 16s-7.16 16-16 16h-47.19c-16.45 0-31.27-9.14-38.64-23.86-2.95-5.92-8.09-6.52-10.17-6.52s-7.22.59-10.02 6.19l-7.67 15.34a15.986 15.986 0 0 1-14.31 8.84c-.38 0-.75-.02-1.14-.05-6.45-.45-12-4.75-14.03-10.89L144 354.59l-10.61 31.88c-5.89 17.66-22.38 29.53-41 29.53H80c-8.84 0-16-7.16-16-16s7.16-16 16-16h12.39c4.83 0 9.11-3.08 10.64-7.66l18.19-54.64c3.3-9.81 12.44-16.41 22.78-16.41s19.48 6.59 22.77 16.41l13.88 41.64c19.77-16.19 54.05-9.7 66 14.16 2.02 4.06 5.96 6.5 10.16 6.5zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"/></svg>
        <span>License</span>
    </a>
    <a class="enabled" href="extension.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"/></svg>
        <span>Previous: Extension</span>
    </a>
    <a class="enabled" href="commands.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"/></svg>
        <span>Next: Commands</span>
    </a>
        </div>
        
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
    </div>
    
    <div class="layout">
        <div class="sidepane collapsible">
            
    <div class="tocmenu">
        <h3>Table of Contents</h3>
        
    <ul>
        
    <li>
        
        <a href="../README.html">Home</a>
        
    </li>
    <li>
        
        <a href="../tutorial.html">Tutorial</a>
        
    </li>
    <li>
        <button class="accordion">
        Implementation
        </button>
            
    <ul>
        
    <li>
        
        <a href="extension.html">Extension</a>
        
    </li>
    <li>
        
        <a href="actions.html" class="highlight">Actions</a>
        
    </li>
    <li>
        
        <a href="commands.html">Commands</a>
        
    </li>
    </ul>
    </li>
    <li>
        
        <a href="../CHANGELOG.html">Changelog</a>
        
    </li>
    <li>
        
        <a href="../LICENSE.html">License</a>
        
    </li>
    </ul>
    </div>
            
    <div class="footer">
        Copyright Â© 2020 Tommi Johtela
        <div class="ad">
            Created with <a href="https://github.com/johtela/litscript">LiTScript</a>
        </div>
    </div>

        </div>
        <div class="sideicon collapsible">
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        <div class="scrollingarea closepopups">
            
    <div class="contentarea">
        <h1 id="converting-keybinding-definitions-to-actions">Converting Keybinding Definitions to Actions</h1>
<p>This module defines the schema of the configuration file using TypeScript
interfaces. We parse the configuration JSON to TypeScript objects which
directly define all the valid keyboard sequences and the commands that these
will invoke.</p>
<details>
<summary>action.ts imports</summary>
<pre class="syntaxhighlight"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="356" data-toggle="tooltip" data-title="typeof vscode">vscode</span> <span class="keyword">from</span> <span class="string">&#039;vscode&#039;</span>
</code></pre>
</details>
<h2 id="action-definitions">Action Definitions</h2>
<p>The keybinding configuration consist of <em>actions</em> that can take three forms:
an action can be a command (defined later), a keymap, or a number that refers
to a keymap defined earlier.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">type</span> <span id="382" class="typename" data-toggle="tooltip" data-title="Action">Action</span> <span class="punctuation">=</span> <a href="actions.html#683"><span class="typename" data-toggle="tooltip" data-title="Command">Command</span></a> <span class="punctuation">|</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a> <span class="punctuation">|</span> <span class="keyword">number</span>
</code></pre>
<p>Commands can be invoked in four ways: by specifying just command a name
(string), or using a conditional command, a command with parameters, or a
sequence (array) of commands. The definition is recursive, meaning that a
sequence can contain all four types of commands.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">type</span> <span id="683" class="typename" data-toggle="tooltip" data-title="Command">Command</span> <span class="punctuation">=</span> <span class="keyword">string</span> <span class="punctuation">|</span> <a href="actions.html#1052"><span class="typename" data-toggle="tooltip" data-title="Conditional">Conditional</span></a> <span class="punctuation">|</span> <a href="actions.html#1358"><span class="typename" data-toggle="tooltip" data-title="Parameterized">Parameterized</span></a> <span class="punctuation">|</span> <a href="actions.html#683"><span class="typename" data-toggle="tooltip" data-title="Command">Command</span></a><span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>A conditional command consist of condition (a JavaScript expression) and set
of branches to take depending on the result of the condition. Each branch can
be any type of command defined above.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="1052" class="typename" data-toggle="tooltip" data-title="Conditional">Conditional</span> <span class="punctuation">{</span>
    <span id="1301" data-toggle="tooltip" data-title="string">condition</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span class="punctuation">[</span><span id="1331" data-toggle="tooltip" data-title="string">branch</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">]</span><span class="punctuation">:</span> <a href="actions.html#683"><span class="typename" data-toggle="tooltip" data-title="Command">Command</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>A command that takes arguments can be specified using the <code>Parameterized</code>
interface. Arguments can be given either as an object or a string, which
is assumed to contain a valid JS expression. Additionally, you can specify
that the command is run multiple times by setting the <code>repeat</code> property. The
property must be either a number, or a JS expression that evaluates to a
number. If it evaluates to some other type, the expression is used as a
condition that is evaluated after the command is run. If the expression
returns a truthy value, the command is repeated.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="1358" class="typename" data-toggle="tooltip" data-title="Parameterized">Parameterized</span> <span class="punctuation">{</span>
    <span id="2003" data-toggle="tooltip" data-title="string">command</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span id="2024" data-toggle="tooltip" data-title="string | {} | undefined">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span> <span class="punctuation">|</span> <span class="keyword">string</span>
    <span id="2048" data-toggle="tooltip" data-title="string | number | undefined">repeat</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">number</span> <span class="punctuation">|</span> <span class="keyword">string</span>
<span class="punctuation">}</span>
</code></pre>
<p>A keymap is a dictionary of keys (characters) to actions. Keys are either
single characters or character ranges, denoted by sequences of <code>&lt;char&gt;,&lt;char&gt;</code>
and <code>&lt;char&gt;-&lt;char&gt;</code>. Values of the dictionary can be also nested keymaps.
This is how you can define commands that require  multiple keypresses.</p>
<p><img src="../images/keymap.png" alt="keymap example">
When the value of a key is number, it refers to another keymap whose <code>id</code>
equals the number. The number can also point to the same  keymap where it
resides. With this mechanism, you can define <em>recursive</em> keymaps that can
take (theoretically) infinitely long key sequences. The picture on the right
illustrates this.</p>
<p>The <code>help</code> field contains help text that is shown in the status bar when the
keymap is active.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">interface</span> <span id="2081" class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span> <span class="punctuation">{</span>
    <span id="2933" data-toggle="tooltip" data-title="number">id</span><span class="punctuation">:</span> <span class="keyword">number</span>
    <span id="2949" data-toggle="tooltip" data-title="string">help</span><span class="punctuation">:</span> <span class="keyword">string</span>
    <span class="punctuation">[</span><span id="2974" data-toggle="tooltip" data-title="string">key</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">]</span><span class="punctuation">:</span> <a href="actions.html#382"><span class="typename" data-toggle="tooltip" data-title="Action">Action</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="cursor-shapes">Cursor Shapes</h2>
<p>You can use various cursor shapes in different modes. The list of available
shapes is defined below.</p>
<pre class="syntaxhighlight"><code><span class="keyword">type</span> <span id="2997" class="typename" data-toggle="tooltip" data-title="Cursor">Cursor</span> <span class="punctuation">=</span>
    <span class="punctuation">|</span> <span class="string">&quot;block&quot;</span>
    <span class="punctuation">|</span> <span class="string">&quot;block-outline&quot;</span>
    <span class="punctuation">|</span> <span class="string">&quot;line&quot;</span>
    <span class="punctuation">|</span> <span class="string">&quot;line-thin&quot;</span>
    <span class="punctuation">|</span> <span class="string">&quot;underline&quot;</span>
    <span class="punctuation">|</span> <span class="string">&quot;underline-thin&quot;</span>
    <span class="punctuation">|</span> <span class="keyword">undefined</span>
</code></pre>
<h2 id="configuration-state">Configuration State</h2>
<p>The variables below contain the current cursor configuration.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3400" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">insertCursorStyle</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span>
<span class="keyword">let</span> <span id="3453" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">normalCursorStyle</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span>
<span class="keyword">let</span> <span id="3506" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">searchCursorStyle</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span>
</code></pre>
<p>Another thing you can set in config, is whether ModalEdit starts in normal
mode.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3659" data-toggle="tooltip" data-title="boolean">startInNormalMode</span><span class="punctuation">:</span> <span class="keyword">boolean</span>
</code></pre>
<p>The root of the action configuration is keymap. This defines what key
sequences will be run when keys are pressed in normal mode.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="3840" data-toggle="tooltip" data-title="Keymap">baseKeymap</span><span class="punctuation">:</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a>
<span class="keyword">let</span> <span id="3864" data-toggle="tooltip" data-title="Keymap">selectKeymap</span><span class="punctuation">:</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a>
</code></pre>
<p>The current active keymap is stored here. The active keymap changes when the
user invokes a multi-key action sequence.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4027" data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span><span class="punctuation">:</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a> <span class="punctuation">|</span> <span class="keyword">null</span> <span class="punctuation">=</span> <span class="keyword">null</span>
</code></pre>
<p>The last command run is also stored. This is needed to run commands which
capture the keyboard.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4182" data-toggle="tooltip" data-title="string">lastCommand</span><span class="punctuation">:</span> <span class="keyword">string</span>
</code></pre>
<p>The key sequence that user has pressed is stored for error reporting
purposes and to make it available to command arguments.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4351" data-toggle="tooltip" data-title="string[]">keySequence</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
</code></pre>
<p>We need a dictionary that returns a keymap for given id.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="4454" data-toggle="tooltip" data-title="{ [id: number]: Keymap; }">keymapsById</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="punctuation">[</span><span id="4471" data-toggle="tooltip" data-title="number">id</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">]</span><span class="punctuation">:</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a> <span class="punctuation">}</span>
</code></pre>
<h2 id="configuration-accessors">Configuration Accessors</h2>
<p>The following functions return the current configuration settings.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="4492" class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getInsertCursorStyle</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#3400"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">insertCursorStyle</span></a>
<span class="punctuation">}</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span id="4714" class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getNormalCursorStyle</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#3453"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">normalCursorStyle</span></a>
<span class="punctuation">}</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span id="4821" class="member" data-toggle="tooltip" data-title="() =&gt; vscode.TextEditorCursorStyle">getSearchCursorType</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#3506"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">searchCursorStyle</span></a>
<span class="punctuation">}</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span id="4927" class="member" data-toggle="tooltip" data-title="() =&gt; boolean">getStartInNormalMode</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#3659"><span data-toggle="tooltip" data-title="boolean">startInNormalMode</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>You can also set the last command from outside the module.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="5013" class="member" data-toggle="tooltip" data-title="(command: string) =&gt; void">setLastCommand</span><span class="punctuation">(</span><span id="5119" data-toggle="tooltip" data-title="string">command</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="actions.html#4182"><span data-toggle="tooltip" data-title="string">lastCommand</span></a> <span class="punctuation">=</span> <a href="actions.html#5119"><span data-toggle="tooltip" data-title="string">command</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="logging">Logging</h2>
<p>To enable logging and error reporting ModalEdit creates an output channel
that is visible in the output pane. The channel is created in the extension
activation hook, but it is passed to this module using the <code>setOutputChannel</code>
function.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="5456" data-toggle="tooltip" data-title="vscode.OutputChannel">outputChannel</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.OutputChannel">OutputChannel</span>

<span class="keyword">export</span> <span class="keyword">function</span> <span id="5492" class="member" data-toggle="tooltip" data-title="(channel: vscode.OutputChannel) =&gt; void">setOutputChannel</span><span class="punctuation">(</span><span id="5529" data-toggle="tooltip" data-title="vscode.OutputChannel">channel</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.OutputChannel">OutputChannel</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="actions.html#5456"><span data-toggle="tooltip" data-title="vscode.OutputChannel">outputChannel</span></a> <span class="punctuation">=</span> <a href="actions.html#5529"><span data-toggle="tooltip" data-title="vscode.OutputChannel">channel</span></a>
<span class="punctuation">}</span>
</code></pre>
<p>Once the channel is set, we can output messages to it using the <code>log</code>
function.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="5593" class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span><span class="punctuation">(</span><span id="5714" data-toggle="tooltip" data-title="string">message</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="actions.html#5456"><span data-toggle="tooltip" data-title="vscode.OutputChannel">outputChannel</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(value: string) =&gt; void">appendLine</span><span class="punctuation">(</span><a href="actions.html#5714"><span data-toggle="tooltip" data-title="string">message</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="updating-configuration-from-settings-json">Updating Configuration from settings.json</h2>
<p>Whenever you save the user-level <code>settings.json</code> or the one located in the
<code>.vsode</code> directory VS Code calls this function that updates the current
configuration.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="5774" class="member" data-toggle="tooltip" data-title="() =&gt; void">updateFromConfig</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">void</span> <span class="punctuation">{</span>
    <span class="keyword">const</span> <span id="6069" data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span> <span class="punctuation">=</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.workspace">workspace</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(section?: string | undefined, scope?: vscode.Uri | vscode.TextDocument | vscode.WorkspaceFolder | { uri?: vscode.Uri | undefined; languageId: string; } | null | undefined) =&gt; vscode.WorkspaceConfiguration">getConfiguration</span><span class="punctuation">(</span><span class="string">&quot;modaledit&quot;</span><span class="punctuation">)</span>
    <a href="actions.html#6537"><span class="member" data-toggle="tooltip" data-title="(config: vscode.WorkspaceConfiguration) =&gt; void">UpdateKeybindings</span></a><span class="punctuation">(</span><a href="actions.html#6069"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">)</span>
    <a href="actions.html#3400"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">insertCursorStyle</span></a> <span class="punctuation">=</span> <a href="actions.html#9869"><span class="member" data-toggle="tooltip" data-title="(cursor: Cursor) =&gt; vscode.TextEditorCursorStyle">toVSCursorStyle</span></a><span class="punctuation">(</span>
        <a href="actions.html#6069"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><a href="actions.html#2997"><span class="typename" data-toggle="tooltip" data-title="Cursor">Cursor</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;insertCursorStyle&quot;</span><span class="punctuation">,</span> <span class="string">&quot;line&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
    <a href="actions.html#3453"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">normalCursorStyle</span></a> <span class="punctuation">=</span> <a href="actions.html#9869"><span class="member" data-toggle="tooltip" data-title="(cursor: Cursor) =&gt; vscode.TextEditorCursorStyle">toVSCursorStyle</span></a><span class="punctuation">(</span>
        <a href="actions.html#6069"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><a href="actions.html#2997"><span class="typename" data-toggle="tooltip" data-title="Cursor">Cursor</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;normalCursorStyle&quot;</span><span class="punctuation">,</span> <span class="string">&quot;block&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
    <a href="actions.html#3506"><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">searchCursorStyle</span></a> <span class="punctuation">=</span> <a href="actions.html#9869"><span class="member" data-toggle="tooltip" data-title="(cursor: Cursor) =&gt; vscode.TextEditorCursorStyle">toVSCursorStyle</span></a><span class="punctuation">(</span>
        <a href="actions.html#6069"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><a href="actions.html#2997"><span class="typename" data-toggle="tooltip" data-title="Cursor">Cursor</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;searchCursorStyle&quot;</span><span class="punctuation">,</span> <span class="string">&quot;underline&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
    <a href="actions.html#3659"><span data-toggle="tooltip" data-title="boolean">startInNormalMode</span></a> <span class="punctuation">=</span> <a href="actions.html#6069"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><span class="keyword">boolean</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;startInNormalMode&quot;</span><span class="punctuation">,</span> <span class="keyword">true</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>The following function updates base keymap and select-mode keymap.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="6537" class="member" data-toggle="tooltip" data-title="(config: vscode.WorkspaceConfiguration) =&gt; void">UpdateKeybindings</span><span class="punctuation">(</span><span id="6647" data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">WorkspaceConfiguration</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <a href="actions.html#5593"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span></a><span class="punctuation">(</span><span class="string">&quot;Validating keybindings in &#039;settings.json&#039;...&quot;</span><span class="punctuation">)</span>
    <a href="actions.html#4454"><span data-toggle="tooltip" data-title="{ [id: number]: Keymap; }">keymapsById</span></a> <span class="punctuation">=</span> <span class="punctuation">{</span><span class="punctuation">}</span>
    <a href="actions.html#7613"><span data-toggle="tooltip" data-title="number">errors</span></a> <span class="punctuation">=</span> <span class="number">0</span>
    <span class="keyword">let</span> <span id="6791" data-toggle="tooltip" data-title="object | undefined">sel</span> <span class="punctuation">=</span> <a href="actions.html#6647"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><span class="keyword">object</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;selectbindings&quot;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#12319"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Keymap">isKeymap</span></a><span class="punctuation">(</span><a href="actions.html#6791"><span data-toggle="tooltip" data-title="object | undefined">sel</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#3864"><span data-toggle="tooltip" data-title="Keymap">selectKeymap</span></a> <span class="punctuation">=</span> <a href="actions.html#6791"><span data-toggle="tooltip" data-title="Keymap">sel</span></a>
        <a href="actions.html#8037"><span class="member" data-toggle="tooltip" data-title="(keybindings: Keymap) =&gt; void">validateAndResolveKeymaps</span></a><span class="punctuation">(</span><a href="actions.html#6791"><span data-toggle="tooltip" data-title="Keymap">sel</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">let</span> <span id="6944" data-toggle="tooltip" data-title="object | undefined">base</span> <span class="punctuation">=</span> <a href="actions.html#6647"><span data-toggle="tooltip" data-title="vscode.WorkspaceConfiguration">config</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(section: string): T | undefined; &lt;T&gt;(section: string, defaultValue: T): T; }">get</span><span class="punctuation">&lt;</span><span class="keyword">object</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="string">&quot;keybindings&quot;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#12319"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Keymap">isKeymap</span></a><span class="punctuation">(</span><a href="actions.html#6944"><span data-toggle="tooltip" data-title="object | undefined">base</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#3840"><span data-toggle="tooltip" data-title="Keymap">baseKeymap</span></a> <span class="punctuation">=</span> <a href="actions.html#6944"><span data-toggle="tooltip" data-title="Keymap">base</span></a>
        <a href="actions.html#8037"><span class="member" data-toggle="tooltip" data-title="(keybindings: Keymap) =&gt; void">validateAndResolveKeymaps</span></a><span class="punctuation">(</span><a href="actions.html#6944"><span data-toggle="tooltip" data-title="Keymap">base</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span>
        <a href="actions.html#5593"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span></a><span class="punctuation">(</span><span class="string">&quot;ERROR: Invalid configuration structure. Keybindings not updated.&quot;</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#7613"><span data-toggle="tooltip" data-title="number">errors</span></a> <span class="punctuation">&gt;</span> <span class="number">0</span><span class="punctuation">)</span>
        <a href="actions.html#5593"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span></a><span class="punctuation">(</span><span class="string">`Found ${</span><a href="actions.html#7613"><span data-toggle="tooltip" data-title="number">errors</span></a><span class="string">} error${</span><a href="actions.html#7613"><span data-toggle="tooltip" data-title="number">errors</span></a> <span class="punctuation">&gt;</span> <span class="number">1</span> <span class="punctuation">?</span> <span class="string">&quot;s&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">}. `</span> <span class="punctuation">+</span>
            <span class="string">&quot;Keybindings might not work correctly.&quot;</span><span class="punctuation">)</span>
    <span class="keyword">else</span>
        <a href="actions.html#5593"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span></a><span class="punctuation">(</span><span class="string">&quot;Validation completed successfully.&quot;</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>To make sure that the keybinding section is valid, we define a function that
checks it. At the same time the function resolves all the keymaps that are
referred by an id. It records the number of errors.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="7613" data-toggle="tooltip" data-title="number">errors</span><span class="punctuation">:</span> <span class="keyword">number</span>
</code></pre>
<p>The keymap ranges are recognized with the following regular expression.
Examples of valid key sequences include:</p>
<ul>
<li><code>0-9</code></li>
<li><code>a,b,c</code></li>
<li><code>d,e-h,l</code></li>
</ul>
<p>Basically you can add individual characters to the range with a comma <code>,</code> and
an ASCII range with dash <code>-</code>. The ASCII code of the first character must be
smaller than the second one's.</p>
<pre class="syntaxhighlight"><code><span class="keyword">let</span> <span id="8014" data-toggle="tooltip" data-title="RegExp">keyRE</span> <span class="punctuation">=</span> <span class="string">/^.([\-,].)+$/</span>
</code></pre>
<p>The function itself is recursive; it calls itself, if it finds a nested
keymap. It stores all the keymaps it encounters in the <code>keymapsById</code>
dictionary.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="8037" class="member" data-toggle="tooltip" data-title="(keybindings: Keymap) =&gt; void">validateAndResolveKeymaps</span><span class="punctuation">(</span><span id="8250" data-toggle="tooltip" data-title="Keymap">keybindings</span><span class="punctuation">:</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">function</span> <span id="8272" class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">error</span><span class="punctuation">(</span><span id="8293" data-toggle="tooltip" data-title="string">message</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#5593"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">log</span></a><span class="punctuation">(</span><span class="string">&quot;ERROR: &quot;</span> <span class="punctuation">+</span> <a href="actions.html#8293"><span data-toggle="tooltip" data-title="string">message</span></a><span class="punctuation">)</span>
        <a href="actions.html#7613"><span data-toggle="tooltip" data-title="number">errors</span></a><span class="punctuation">++</span>
    <span class="punctuation">}</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">.</span><a href="actions.html#2933"><span data-toggle="tooltip" data-title="number">id</span></a> <span class="punctuation">===</span> <span class="string">&#039;number&#039;</span><span class="punctuation">)</span>
        <a href="actions.html#4454"><span data-toggle="tooltip" data-title="{ [id: number]: Keymap; }">keymapsById</span></a><span class="punctuation">[</span><a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">.</span><a href="actions.html#2933"><span data-toggle="tooltip" data-title="number">id</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a>
    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="8480" data-toggle="tooltip" data-title="string">key</span> <span class="keyword">in</span> <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(v: string | number | symbol) =&gt; boolean">hasOwnProperty</span><span class="punctuation">(</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a> <span class="punctuation">!=</span> <span class="string">&quot;id&quot;</span> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a> <span class="punctuation">!=</span> <span class="string">&quot;help&quot;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="8599" data-toggle="tooltip" data-title="Action">target</span> <span class="punctuation">=</span> <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">[</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#12319"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Keymap">isKeymap</span></a><span class="punctuation">(</span><a href="actions.html#8599"><span data-toggle="tooltip" data-title="Action">target</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                <a href="actions.html#8037"><span class="member" data-toggle="tooltip" data-title="(keybindings: Keymap) =&gt; void">validateAndResolveKeymaps</span></a><span class="punctuation">(</span><a href="actions.html#8599"><span data-toggle="tooltip" data-title="Keymap">target</span></a><span class="punctuation">)</span>
            <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="string | number | Conditional | Parameterized | Command[]">target</span></a> <span class="punctuation">===</span> <span class="string">&#039;number&#039;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                <span class="keyword">let</span> <span id="8784" data-toggle="tooltip" data-title="number">id</span> <span class="punctuation">=</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="number">target</span></a>
                <a href="actions.html#8599"><span data-toggle="tooltip" data-title="Action">target</span></a> <span class="punctuation">=</span> <a href="actions.html#4454"><span data-toggle="tooltip" data-title="{ [id: number]: Keymap; }">keymapsById</span></a><span class="punctuation">[</span><a href="actions.html#8784"><span data-toggle="tooltip" data-title="number">id</span></a><span class="punctuation">]</span>
                <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="actions.html#8599"><span data-toggle="tooltip" data-title="Keymap">target</span></a><span class="punctuation">)</span>
                    <a href="actions.html#8272"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">error</span></a><span class="punctuation">(</span><span class="string">`Undefined keymap id: ${</span><a href="actions.html#8784"><span data-toggle="tooltip" data-title="number">id</span></a><span class="string">}`</span><span class="punctuation">)</span>
                <span class="keyword">else</span>
                    <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">[</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="Keymap">target</span></a>
            <span class="punctuation">}</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (regexp: string | RegExp): RegExpMatchArray | null; (matcher: { [Symbol.match](string: string): RegExpMatchArray | null; }): RegExpMatchArray | null; }">match</span><span class="punctuation">(</span><a href="actions.html#8014"><span data-toggle="tooltip" data-title="RegExp">keyRE</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
                <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="9070" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">1</span><span class="punctuation">;</span> <a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span><span class="punctuation">;</span> <a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">+=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">[</span><a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">]</span> <span class="punctuation">==</span> <span class="string">&#039;-&#039;</span><span class="punctuation">)</span> <span class="punctuation">{</span>
                        <span class="keyword">let</span> <span id="9174" data-toggle="tooltip" data-title="number">first</span> <span class="punctuation">=</span> <a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(index: number) =&gt; number">charCodeAt</span><span class="punctuation">(</span><a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">)</span>
                        <span class="keyword">let</span> <span id="9233" data-toggle="tooltip" data-title="number">last</span> <span class="punctuation">=</span> <a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(index: number) =&gt; number">charCodeAt</span><span class="punctuation">(</span><a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">+</span> <span class="number">1</span><span class="punctuation">)</span>
                        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#9174"><span data-toggle="tooltip" data-title="number">first</span></a> <span class="punctuation">&gt;</span> <a href="actions.html#9233"><span data-toggle="tooltip" data-title="number">last</span></a><span class="punctuation">)</span>
                            <a href="actions.html#8272"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">error</span></a><span class="punctuation">(</span><span class="string">`Invalid key range: &quot;${</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="string">}&quot;`</span><span class="punctuation">)</span>
                        <span class="keyword">else</span>
                            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="9439" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <a href="actions.html#9174"><span data-toggle="tooltip" data-title="number">first</span></a><span class="punctuation">;</span> <a href="actions.html#9439"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;=</span> <a href="actions.html#9233"><span data-toggle="tooltip" data-title="number">last</span></a><span class="punctuation">;</span> <a href="actions.html#9439"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span>
                                <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">[</span><span class="typename" data-toggle="tooltip" data-title="StringConstructor">String</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...codes: number[]) =&gt; string">fromCharCode</span><span class="punctuation">(</span><a href="actions.html#9439"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">)</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="string | Conditional | Parameterized | Command[] | Keymap">target</span></a>
                    <span class="punctuation">}</span>
                    <span class="keyword">else</span> <span class="punctuation">{</span>
                        <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">[</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">[</span><a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">-</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="string | Conditional | Parameterized | Command[] | Keymap">target</span></a>
                        <a href="actions.html#8250"><span data-toggle="tooltip" data-title="Keymap">keybindings</span></a><span class="punctuation">[</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">[</span><a href="actions.html#9070"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">+</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="punctuation">=</span> <a href="actions.html#8599"><span data-toggle="tooltip" data-title="string | Conditional | Parameterized | Command[] | Keymap">target</span></a>
                    <span class="punctuation">}</span>
                <span class="punctuation">}</span>
            <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">length</span> <span class="punctuation">!=</span> <span class="number">1</span><span class="punctuation">)</span>
                <a href="actions.html#8272"><span class="member" data-toggle="tooltip" data-title="(message: string) =&gt; void">error</span></a><span class="punctuation">(</span><span class="string">`Invalid key binding: &quot;${</span><a href="actions.html#8480"><span data-toggle="tooltip" data-title="string">key</span></a><span class="string">}&quot;`</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>The helper function below converts cursor styles specified in configuration
to enumeration members used by VS Code.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="9869" class="member" data-toggle="tooltip" data-title="(cursor: Cursor) =&gt; vscode.TextEditorCursorStyle">toVSCursorStyle</span><span class="punctuation">(</span><span id="10031" data-toggle="tooltip" data-title="Cursor">cursor</span><span class="punctuation">:</span> <a href="actions.html#2997"><span class="typename" data-toggle="tooltip" data-title="Cursor">Cursor</span></a><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="any">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle">TextEditorCursorStyle</span> <span class="punctuation">{</span>
    <span class="keyword">switch</span> <span class="punctuation">(</span><a href="actions.html#10031"><span data-toggle="tooltip" data-title="Cursor">cursor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">case</span> <span class="string">&quot;line&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.Line">Line</span>
        <span class="keyword">case</span> <span class="string">&quot;block&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.Block">Block</span>
        <span class="keyword">case</span> <span class="string">&quot;underline&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.Underline">Underline</span>
        <span class="keyword">case</span> <span class="string">&quot;line-thin&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.LineThin">LineThin</span>
        <span class="keyword">case</span> <span class="string">&quot;block-outline&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.BlockOutline">BlockOutline</span>
        <span class="keyword">case</span> <span class="string">&quot;underline-thin&quot;</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.UnderlineThin">UnderlineThin</span>
        <span class="keyword">default</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.TextEditorCursorStyle">TextEditorCursorStyle</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditorCursorStyle.Line">Line</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="type-predicates">Type Predicates</h2>
<p>Since JavaScript does not have dynamic type information we need to write
functions that check which type of action we get from the configuration.
First we define a high-level type predicate that checks if a value is
an action.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="10605" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isAction</span><span class="punctuation">(</span><span id="10907" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#10907"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#382"><span class="typename" data-toggle="tooltip" data-title="Action">Action</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11398"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isCommand</span></a><span class="punctuation">(</span><a href="actions.html#10907"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#12319"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Keymap">isKeymap</span></a><span class="punctuation">(</span><a href="actions.html#10907"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#11130"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is number">isNumber</span></a><span class="punctuation">(</span><a href="actions.html#10907"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>This one checks whether a value is a string.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="10987" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span><span class="punctuation">(</span><span id="11066" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#11066"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <span class="keyword">string</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11066"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">&amp;&amp;</span> <span class="keyword">typeof</span> <a href="actions.html#11066"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">===</span> <span class="string">&quot;string&quot;</span>
<span class="punctuation">}</span>
</code></pre>
<p>This one checks whether a value is a number.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="11130" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is number">isNumber</span><span class="punctuation">(</span><span id="11209" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#11209"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <span class="keyword">number</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11209"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">&amp;&amp;</span> <span class="keyword">typeof</span> <a href="actions.html#11209"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">===</span> <span class="string">&quot;number&quot;</span>
<span class="punctuation">}</span>
</code></pre>
<p>This one identifies an object.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="11273" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; boolean">isObject</span><span class="punctuation">(</span><span id="11338" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11338"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">&amp;&amp;</span> <span class="keyword">typeof</span> <a href="actions.html#11338"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="punctuation">===</span> <span class="string">&quot;object&quot;</span>
<span class="punctuation">}</span>
</code></pre>
<p>This checks if a value is a command.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="11398" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isCommand</span><span class="punctuation">(</span><span id="11470" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#11470"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#382"><span class="typename" data-toggle="tooltip" data-title="Action">Action</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#11470"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#12015"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Parameterized">isParameterized</span></a><span class="punctuation">(</span><a href="actions.html#11470"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#11764"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Conditional">isConditional</span></a><span class="punctuation">(</span><a href="actions.html#11470"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">||</span>
        <a href="actions.html#11594"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Command[]">isCommandSequence</span></a><span class="punctuation">(</span><a href="actions.html#11470"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>This checks if a value is an array of commands.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="11594" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Command[]">isCommandSequence</span><span class="punctuation">(</span><span id="11685" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#11685"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#683"><span class="typename" data-toggle="tooltip" data-title="Command">Command</span></a><span class="punctuation">[</span><span class="punctuation">]</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="typename" data-toggle="tooltip" data-title="ArrayConstructor">Array</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(arg: any) =&gt; arg is any[]">isArray</span><span class="punctuation">(</span><a href="actions.html#11685"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#11685"><span data-toggle="tooltip" data-title="any[]">x</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: any, index: number, array: any[]) =&gt; unknown, thisArg?: any) =&gt; boolean">every</span><span class="punctuation">(</span><a href="actions.html#11398"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isCommand</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>This recognizes a conditional action.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="11764" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Conditional">isConditional</span><span class="punctuation">(</span><span id="11841" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#11841"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#1052"><span class="typename" data-toggle="tooltip" data-title="Conditional">Conditional</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11273"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; boolean">isObject</span></a><span class="punctuation">(</span><a href="actions.html#11841"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#11841"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>condition<span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span>
        <span class="typename" data-toggle="tooltip" data-title="ObjectConstructor">Object</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (o: object): string[]; (o: {}): string[]; }">keys</span><span class="punctuation">(</span><a href="actions.html#11841"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: string, index: number, array: string[]) =&gt; unknown, thisArg?: any) =&gt; boolean">every</span><span class="punctuation">(</span><span id="11951" data-toggle="tooltip" data-title="string">key</span> <span class="punctuation">=&gt;</span>
            <a href="actions.html#11951"><span data-toggle="tooltip" data-title="string">key</span></a> <span class="punctuation">===</span> <span class="string">&quot;condition&quot;</span> <span class="punctuation">||</span> <a href="actions.html#11398"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isCommand</span></a><span class="punctuation">(</span><a href="actions.html#11841"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">[</span><a href="actions.html#11951"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>This asserts that a value is a parameterized command.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="12015" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Parameterized">isParameterized</span><span class="punctuation">(</span><span id="12110" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#1358"><span class="typename" data-toggle="tooltip" data-title="Parameterized">Parameterized</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11273"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; boolean">isObject</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>command<span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span>
        <span class="punctuation">(</span><span class="punctuation">!</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>args <span class="punctuation">||</span> <a href="actions.html#11273"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; boolean">isObject</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>args<span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>args<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span>
        <span class="punctuation">(</span><span class="punctuation">!</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>repeat <span class="punctuation">||</span> <a href="actions.html#11130"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is number">isNumber</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>repeat<span class="punctuation">)</span> <span class="punctuation">||</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#12110"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">.</span>repeat<span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>And finally this one checks if a value is a keymap.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="12319" class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Keymap">isKeymap</span><span class="punctuation">(</span><span id="12405" data-toggle="tooltip" data-title="any">x</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="actions.html#12405"><span data-toggle="tooltip" data-title="any">x</span></a> <span class="keyword">is</span> <a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#11273"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; boolean">isObject</span></a><span class="punctuation">(</span><a href="actions.html#12405"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <span class="punctuation">!</span><a href="actions.html#11764"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Conditional">isConditional</span></a><span class="punctuation">(</span><a href="actions.html#12405"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span> <span class="punctuation">!</span><a href="actions.html#12015"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Parameterized">isParameterized</span></a><span class="punctuation">(</span><a href="actions.html#12405"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span> <span class="punctuation">&amp;&amp;</span>
        <span class="typename" data-toggle="tooltip" data-title="ObjectConstructor">Object</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ &lt;T&gt;(o: { [s: string]: T; } | ArrayLike&lt;T&gt;): T[]; (o: {}): any[]; }">values</span><span class="punctuation">(</span><a href="actions.html#12405"><span data-toggle="tooltip" data-title="any">x</span></a><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(callbackfn: (value: unknown, index: number, array: unknown[]) =&gt; unknown, thisArg?: any) =&gt; boolean">every</span><span class="punctuation">(</span><a href="actions.html#10605"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isAction</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="executing-commands">Executing Commands</h2>
<p>In the end all keybindings will invoke one or more VS Code commands. The
following function runs a command whose name and arguments are given as
parameters. If the command throws an exception because of invalid arguments,
for example, the error is shown in the popup window at the corner of the
screen.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="12543" class="member" data-toggle="tooltip" data-title="(command: string, ...rest: any[]) =&gt; Promise&lt;void&gt;">executeVSCommand</span><span class="punctuation">(</span><span id="12942" data-toggle="tooltip" data-title="string">command</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span class="punctuation">...</span><span id="12958" data-toggle="tooltip" data-title="any[]">rest</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">try</span> <span class="punctuation">{</span>
        <span class="keyword">await</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.commands">commands</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(command: string, ...rest: any[]) =&gt; Thenable&lt;T | undefined&gt;">executeCommand</span><span class="punctuation">(</span><a href="actions.html#12942"><span data-toggle="tooltip" data-title="string">command</span></a><span class="punctuation">,</span> <span class="punctuation">...</span><a href="actions.html#12958"><span data-toggle="tooltip" data-title="any[]">rest</span></a><span class="punctuation">)</span>
        <a href="actions.html#4182"><span data-toggle="tooltip" data-title="string">lastCommand</span></a> <span class="punctuation">=</span> <a href="actions.html#12942"><span data-toggle="tooltip" data-title="string">command</span></a>
    <span class="punctuation">}</span>
    <span class="keyword">catch</span> <span class="punctuation">(</span><span id="13117" data-toggle="tooltip" data-title="any">error</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (message: string, ...items: string[]): Thenable&lt;string | undefined&gt;; (message: string, options: vscode.MessageOptions, ...items: string[]): Thenable&lt;string | undefined&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, ...items: T[]): Thenable&lt;...&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, options: vscode.Me...">showErrorMessage</span><span class="punctuation">(</span><a href="actions.html#13117"><span data-toggle="tooltip" data-title="any">error</span></a><span class="punctuation">.</span>message<span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p><code>evalString</code> function evaluates JavaScript expressions. Before doing so, it
defines some variables that can be used in the evaluated text.</p>
<pre class="syntaxhighlight"><code><span class="keyword">function</span> <span id="13190" class="member" data-toggle="tooltip" data-title="(str: string, __selecting: boolean) =&gt; any">evalString</span><span class="punctuation">(</span><span id="13369" data-toggle="tooltip" data-title="string">str</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="13381" data-toggle="tooltip" data-title="boolean">__selecting</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">any</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="13419" data-toggle="tooltip" data-title="any">__file</span> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="keyword">let</span> <span id="13447" data-toggle="tooltip" data-title="any">__line</span> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="keyword">let</span> <span id="13475" data-toggle="tooltip" data-title="any">__col</span> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="keyword">let</span> <span id="13502" data-toggle="tooltip" data-title="any">__char</span> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="keyword">let</span> <span id="13530" data-toggle="tooltip" data-title="any">__selection</span> <span class="punctuation">=</span> <span data-toggle="tooltip" data-title="undefined">undefined</span>
    <span class="keyword">let</span> <span id="13563" data-toggle="tooltip" data-title="string[]">__keySequence</span> <span class="punctuation">=</span> <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a>
    <span class="keyword">let</span> <span id="13600" data-toggle="tooltip" data-title="string[]">__keys</span> <span class="punctuation">=</span> <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a>
    <span class="keyword">let</span> <span id="13630" data-toggle="tooltip" data-title="string[]">__rkeys</span> <span class="punctuation">=</span> <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(start?: number | undefined, end?: number | undefined) =&gt; string[]">slice</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="() =&gt; string[]">reverse</span><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="13679" data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span> <span class="punctuation">=</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">activeTextEditor</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor | undefined">editor</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="13751" data-toggle="tooltip" data-title="vscode.Position">cursor</span> <span class="punctuation">=</span> <a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Position">active</span>
        <a href="actions.html#13419"><span data-toggle="tooltip" data-title="any">__file</span></a> <span class="punctuation">=</span> <a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">.</span><span data-toggle="tooltip" data-title="string">fileName</span>
        <a href="actions.html#13447"><span data-toggle="tooltip" data-title="any">__line</span></a> <span class="punctuation">=</span> <a href="actions.html#13751"><span data-toggle="tooltip" data-title="vscode.Position">cursor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">line</span>
        <a href="actions.html#13475"><span data-toggle="tooltip" data-title="any">__col</span></a> <span class="punctuation">=</span> <a href="actions.html#13751"><span data-toggle="tooltip" data-title="vscode.Position">cursor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="number">character</span>
        <a href="actions.html#13502"><span data-toggle="tooltip" data-title="any">__char</span></a> <span class="punctuation">=</span> <a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><span class="keyword">new</span> <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span class="typename" data-toggle="tooltip" data-title="typeof vscode.Range">Range</span><span class="punctuation">(</span><a href="actions.html#13751"><span data-toggle="tooltip" data-title="vscode.Position">cursor</span></a><span class="punctuation">,</span>
            <a href="actions.html#13751"><span data-toggle="tooltip" data-title="vscode.Position">cursor</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (lineDelta?: number | undefined, characterDelta?: number | undefined): vscode.Position; (change: { lineDelta?: number | undefined; characterDelta?: number | undefined; }): vscode.Position; }">translate</span><span class="punctuation">(</span><span class="punctuation">{</span> <span id="13990" data-toggle="tooltip" data-title="number">characterDelta</span><span class="punctuation">:</span> <span class="number">1</span> <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="actions.html#13530"><span data-toggle="tooltip" data-title="any">__selection</span></a> <span class="punctuation">=</span> <a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.TextDocument">document</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(range?: vscode.Range | undefined) =&gt; string">getText</span><span class="punctuation">(</span><a href="actions.html#13679"><span data-toggle="tooltip" data-title="vscode.TextEditor">editor</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="vscode.Selection">selection</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">try</span> <span class="punctuation">{</span>
        <span class="keyword">return</span> <span class="member" data-toggle="tooltip" data-title="(x: string) =&gt; any">eval</span><span class="punctuation">(</span><span class="string">`(${</span><a href="actions.html#13369"><span data-toggle="tooltip" data-title="string">str</span></a><span class="string">})`</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">catch</span> <span class="punctuation">(</span><span id="14149" data-toggle="tooltip" data-title="any">error</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (message: string, ...items: string[]): Thenable&lt;string | undefined&gt;; (message: string, options: vscode.MessageOptions, ...items: string[]): Thenable&lt;string | undefined&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, ...items: T[]): Thenable&lt;...&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, options: vscode.Me...">showErrorMessage</span><span class="punctuation">(</span><span class="string">&quot;Evaluation error: &quot;</span> <span class="punctuation">+</span> <a href="actions.html#14149"><span data-toggle="tooltip" data-title="any">error</span></a><span class="punctuation">.</span>message<span class="punctuation">)</span>
    <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>
<p>We need the evaluation function when executing conditional command. The
condition is evaluated and if a key is found that matches the result, it is
executed.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="14245" class="member" data-toggle="tooltip" data-title="(cond: Conditional, selecting: boolean) =&gt; Promise&lt;void&gt;">executeConditional</span><span class="punctuation">(</span><span id="14461" data-toggle="tooltip" data-title="Conditional">cond</span><span class="punctuation">:</span> <a href="actions.html#1052"><span class="typename" data-toggle="tooltip" data-title="Conditional">Conditional</span></a><span class="punctuation">,</span> <span id="14479" data-toggle="tooltip" data-title="boolean">selecting</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span>
    <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="14530" data-toggle="tooltip" data-title="any">res</span> <span class="punctuation">=</span> <a href="actions.html#13190"><span class="member" data-toggle="tooltip" data-title="(str: string, __selecting: boolean) =&gt; any">evalString</span></a><span class="punctuation">(</span><a href="actions.html#14461"><span data-toggle="tooltip" data-title="Conditional">cond</span></a><span class="punctuation">.</span><a href="actions.html#1301"><span data-toggle="tooltip" data-title="string">condition</span></a><span class="punctuation">,</span> <a href="actions.html#14479"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
    <span class="keyword">let</span> <span id="14583" data-toggle="tooltip" data-title="string">branch</span> <span class="punctuation">=</span> <a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#14530"><span data-toggle="tooltip" data-title="any">res</span></a><span class="punctuation">)</span> <span class="punctuation">?</span> <a href="actions.html#14530"><span data-toggle="tooltip" data-title="string">res</span></a> <span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="JSON">JSON</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (value: any, replacer?: ((this: any, key: string, value: any) =&gt; any) | undefined, space?: string | number | undefined): string; (value: any, replacer?: (string | number)[] | null | undefined, space?: string | ... 1 more ... | undefined): string; }">stringify</span><span class="punctuation">(</span><a href="actions.html#14530"><span data-toggle="tooltip" data-title="any">res</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#14583"><span data-toggle="tooltip" data-title="string">branch</span></a> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#10605"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Action">isAction</span></a><span class="punctuation">(</span><a href="actions.html#14461"><span data-toggle="tooltip" data-title="Conditional">cond</span></a><span class="punctuation">[</span><a href="actions.html#14583"><span data-toggle="tooltip" data-title="string">branch</span></a><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="actions.html#16395"><span class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span></a><span class="punctuation">(</span><a href="actions.html#14461"><span data-toggle="tooltip" data-title="Conditional">cond</span></a><span class="punctuation">[</span><a href="actions.html#14583"><span data-toggle="tooltip" data-title="string">branch</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <a href="actions.html#14479"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<p>Parameterized commands can get their arguments in two forms: as a string
that is evaluated to get the actual arguments, or as an object. Before
executing the command, we inspect the <code>repeat</code> property. If it is string
we evaluate it, and check if the result is a number. If so, we update the
<code>repeat</code> variable that designates repetition count. If not, we treate it as
a continue condition. The subroutine <code>exec</code> runs the command either <code>repeat</code>
times or as long as the expression in the <code>repeat</code> property returns a truthy
value.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="14728" class="member" data-toggle="tooltip" data-title="(action: Parameterized, selecting: boolean) =&gt; Promise&lt;void&gt;">executeParameterized</span><span class="punctuation">(</span><span id="15342" data-toggle="tooltip" data-title="Parameterized">action</span><span class="punctuation">:</span> <a href="actions.html#1358"><span class="typename" data-toggle="tooltip" data-title="Parameterized">Parameterized</span></a><span class="punctuation">,</span> <span id="15364" data-toggle="tooltip" data-title="boolean">selecting</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">let</span> <span id="15395" data-toggle="tooltip" data-title="string | number">repeat</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">number</span> <span class="punctuation">=</span> <span class="number">1</span>
    <span class="keyword">async</span> <span class="keyword">function</span> <span id="15423" class="member" data-toggle="tooltip" data-title="(args?: any) =&gt; Promise&lt;void&gt;">exec</span><span class="punctuation">(</span><span id="15449" data-toggle="tooltip" data-title="any">args</span><span class="punctuation">?</span><span class="punctuation">:</span> <span class="keyword">any</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">let</span> <span id="15475" data-toggle="tooltip" data-title="boolean">cont</span> <span class="punctuation">=</span> <span class="keyword">true</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#15395"><span data-toggle="tooltip" data-title="string | number">repeat</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
            <span class="keyword">do</span> <span class="punctuation">{</span>
                <span class="keyword">await</span> <a href="actions.html#12543"><span class="member" data-toggle="tooltip" data-title="(command: string, ...rest: any[]) =&gt; Promise&lt;void&gt;">executeVSCommand</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2003"><span data-toggle="tooltip" data-title="string">command</span></a><span class="punctuation">,</span> <a href="actions.html#15449"><span data-toggle="tooltip" data-title="any">args</span></a><span class="punctuation">)</span>
                <a href="actions.html#15475"><span data-toggle="tooltip" data-title="boolean">cont</span></a> <span class="punctuation">=</span> <a href="actions.html#13190"><span class="member" data-toggle="tooltip" data-title="(str: string, __selecting: boolean) =&gt; any">evalString</span></a><span class="punctuation">(</span><a href="actions.html#15395"><span data-toggle="tooltip" data-title="string">repeat</span></a><span class="punctuation">,</span> <a href="actions.html#15364"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
            <span class="punctuation">}</span>
            <span class="keyword">while</span> <span class="punctuation">(</span><a href="actions.html#15475"><span data-toggle="tooltip" data-title="boolean">cont</span></a><span class="punctuation">)</span>
        <span class="keyword">else</span>
            <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">let</span> <span id="15729" data-toggle="tooltip" data-title="number">i</span> <span class="punctuation">=</span> <span class="number">0</span><span class="punctuation">;</span> <a href="actions.html#15729"><span data-toggle="tooltip" data-title="number">i</span></a> <span class="punctuation">&lt;</span> <a href="actions.html#15395"><span data-toggle="tooltip" data-title="number">repeat</span></a><span class="punctuation">;</span> <a href="actions.html#15729"><span data-toggle="tooltip" data-title="number">i</span></a><span class="punctuation">++</span><span class="punctuation">)</span>
                <span class="keyword">await</span> <a href="actions.html#12543"><span class="member" data-toggle="tooltip" data-title="(command: string, ...rest: any[]) =&gt; Promise&lt;void&gt;">executeVSCommand</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2003"><span data-toggle="tooltip" data-title="string">command</span></a><span class="punctuation">,</span> <a href="actions.html#15449"><span data-toggle="tooltip" data-title="any">args</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2048"><span data-toggle="tooltip" data-title="string | number | undefined">repeat</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2048"><span data-toggle="tooltip" data-title="string | number">repeat</span></a><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">let</span> <span id="15905" data-toggle="tooltip" data-title="any">val</span> <span class="punctuation">=</span> <a href="actions.html#13190"><span class="member" data-toggle="tooltip" data-title="(str: string, __selecting: boolean) =&gt; any">evalString</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2048"><span data-toggle="tooltip" data-title="string">repeat</span></a><span class="punctuation">,</span> <a href="actions.html#15364"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="actions.html#15905"><span data-toggle="tooltip" data-title="any">val</span></a> <span class="punctuation">===</span> <span class="string">&#039;number&#039;</span><span class="punctuation">)</span>
                <a href="actions.html#15395"><span data-toggle="tooltip" data-title="string | number">repeat</span></a> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="Math">Math</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...values: number[]) =&gt; number">max</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <a href="actions.html#15905"><span data-toggle="tooltip" data-title="number">val</span></a><span class="punctuation">)</span>
            <span class="keyword">else</span>
                <a href="actions.html#15395"><span data-toggle="tooltip" data-title="string | number">repeat</span></a> <span class="punctuation">=</span> <a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2048"><span data-toggle="tooltip" data-title="string">repeat</span></a>
        <span class="punctuation">}</span>
        <span class="keyword">else</span>
            <a href="actions.html#15395"><span data-toggle="tooltip" data-title="string | number">repeat</span></a> <span class="punctuation">=</span> <span class="typename" data-toggle="tooltip" data-title="Math">Math</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...values: number[]) =&gt; number">max</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2048"><span data-toggle="tooltip" data-title="number">repeat</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2024"><span data-toggle="tooltip" data-title="string | {} | undefined">args</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2024"><span data-toggle="tooltip" data-title="string | {}">args</span></a> <span class="punctuation">===</span> <span class="string">&#039;string&#039;</span><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="actions.html#15423"><span class="member" data-toggle="tooltip" data-title="(args?: any) =&gt; Promise&lt;void&gt;">exec</span></a><span class="punctuation">(</span><a href="actions.html#13190"><span class="member" data-toggle="tooltip" data-title="(str: string, __selecting: boolean) =&gt; any">evalString</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2024"><span data-toggle="tooltip" data-title="string">args</span></a><span class="punctuation">,</span> <a href="actions.html#15364"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">else</span>
            <span class="keyword">await</span> <a href="actions.html#15423"><span class="member" data-toggle="tooltip" data-title="(args?: any) =&gt; Promise&lt;void&gt;">exec</span></a><span class="punctuation">(</span><a href="actions.html#15342"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">.</span><a href="actions.html#2024"><span data-toggle="tooltip" data-title="{}">args</span></a><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span>
        <span class="keyword">await</span> <a href="actions.html#15423"><span class="member" data-toggle="tooltip" data-title="(args?: any) =&gt; Promise&lt;void&gt;">exec</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>
<h2 id="executing-actions">Executing Actions</h2>
<p>Before running any commands, we need to identify which type of action we got.
Depending on the type we use different function to execute the command. If
the action is not a command, it has to be a keymap. Since we resolved <code>id</code>
referenences in <code>validateAndResolveKeymaps</code>, an action has to be a keymap
object at this point. We set the new keymap as the active one.</p>
<pre class="syntaxhighlight"><code><span class="keyword">async</span> <span class="keyword">function</span> <span id="16395" class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span><span class="punctuation">(</span><span id="16847" data-toggle="tooltip" data-title="Action">action</span><span class="punctuation">:</span> <a href="actions.html#382"><span class="typename" data-toggle="tooltip" data-title="Action">Action</span></a><span class="punctuation">,</span> <span id="16862" data-toggle="tooltip" data-title="boolean">selecting</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">void</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a> <span class="punctuation">=</span> <span class="keyword">null</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#10987"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is string">isString</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="Action">action</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="actions.html#12543"><span class="member" data-toggle="tooltip" data-title="(command: string, ...rest: any[]) =&gt; Promise&lt;void&gt;">executeVSCommand</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="string">action</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#11594"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Command[]">isCommandSequence</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="number | Conditional | Parameterized | Command[] | Keymap">action</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword">const</span> <span id="17053" data-toggle="tooltip" data-title="Command">command</span> <span class="keyword">of</span> <a href="actions.html#16847"><span data-toggle="tooltip" data-title="Command[]">action</span></a><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="actions.html#16395"><span class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span></a><span class="punctuation">(</span><a href="actions.html#17053"><span data-toggle="tooltip" data-title="Command">command</span></a><span class="punctuation">,</span> <a href="actions.html#16862"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#11764"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Conditional">isConditional</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="number | Conditional | Parameterized | Keymap">action</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="actions.html#14245"><span class="member" data-toggle="tooltip" data-title="(cond: Conditional, selecting: boolean) =&gt; Promise&lt;void&gt;">executeConditional</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="Conditional">action</span></a><span class="punctuation">,</span> <a href="actions.html#16862"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#12015"><span class="member" data-toggle="tooltip" data-title="(x: any) =&gt; x is Parameterized">isParameterized</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="number | Parameterized | Keymap">action</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="keyword">await</span> <a href="actions.html#14728"><span class="member" data-toggle="tooltip" data-title="(action: Parameterized, selecting: boolean) =&gt; Promise&lt;void&gt;">executeParameterized</span></a><span class="punctuation">(</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="Parameterized">action</span></a><span class="punctuation">,</span> <a href="actions.html#16862"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span>
        <a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a> <span class="punctuation">=</span> <span class="punctuation">&lt;</span><a href="actions.html#2081"><span class="typename" data-toggle="tooltip" data-title="Keymap">Keymap</span></a><span class="punctuation">&gt;</span><a href="actions.html#16847"><span data-toggle="tooltip" data-title="number | Keymap">action</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="key-press-handler">Key Press Handler</h2>
<p>Now that the plumbing of actions is implemented, it is straightforward to
map the pressed key to an action. The special case occurs when a command
captures the keyboard. Then we rerun the previous command and give the key
to it as an argument.</p>
<p>Otherwise we just check if the current keymap contains binding for the key
pressed, and execute the action. If not, we present an error to the user.</p>
<p>As a last step the function returns <code>true</code>, if the current keymap is <code>null</code>.
This indicates that the key invoked a command instead of just changing the
active keymap.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span id="17356" class="member" data-toggle="tooltip" data-title="(key: string, selecting: boolean, capture: boolean, userInitiated: boolean) =&gt; Promise&lt;boolean&gt;">handleKey</span><span class="punctuation">(</span><span id="18038" data-toggle="tooltip" data-title="string">key</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span id="18050" data-toggle="tooltip" data-title="boolean">selecting</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">,</span>
    <span id="18070" data-toggle="tooltip" data-title="boolean">capture</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">,</span> <span id="18093" data-toggle="tooltip" data-title="boolean">userInitiated</span><span class="punctuation">:</span> <span class="keyword">boolean</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="typename" data-toggle="tooltip" data-title="Promise&lt;T&gt;">Promise</span><span class="punctuation">&lt;</span><span class="keyword">boolean</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>

    <span class="keyword">function</span> <span id="18137" class="member" data-toggle="tooltip" data-title="() =&gt; void">error</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <a href="actions.html#356"><span data-toggle="tooltip" data-title="typeof vscode">vscode</span></a><span class="punctuation">.</span><span data-toggle="tooltip" data-title="typeof vscode.window">window</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="{ (message: string, ...items: string[]): Thenable&lt;string | undefined&gt;; (message: string, options: vscode.MessageOptions, ...items: string[]): Thenable&lt;string | undefined&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, ...items: T[]): Thenable&lt;...&gt;; &lt;T extends vscode.MessageItem&gt;(message: string, options: vscode.Me...">showWarningMessage</span><span class="punctuation">(</span><span class="string">&quot;ModalEdit: Undefined key binding: &quot;</span> <span class="punctuation">+</span>
            <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(separator?: string | undefined) =&gt; string">join</span><span class="punctuation">(</span><span class="string">&quot; - &quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a> <span class="punctuation">=</span> <span class="keyword">null</span>
    <span class="punctuation">}</span>

    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#18093"><span data-toggle="tooltip" data-title="boolean">userInitiated</span></a><span class="punctuation">)</span>
        <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(...items: string[]) =&gt; number">push</span><span class="punctuation">(</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#18070"><span data-toggle="tooltip" data-title="boolean">capture</span></a> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#4182"><span data-toggle="tooltip" data-title="string">lastCommand</span></a><span class="punctuation">)</span>
        <a href="actions.html#12543"><span class="member" data-toggle="tooltip" data-title="(command: string, ...rest: any[]) =&gt; Promise&lt;void&gt;">executeVSCommand</span></a><span class="punctuation">(</span><a href="actions.html#4182"><span data-toggle="tooltip" data-title="string">lastCommand</span></a><span class="punctuation">,</span> <a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">)</span>
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap">currentKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="actions.html#16395"><span class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span></a><span class="punctuation">(</span><a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap">currentKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <a href="actions.html#18050"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
        <span class="keyword">else</span>
            <a href="actions.html#18137"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">error</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">else</span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#18050"><span data-toggle="tooltip" data-title="boolean">selecting</span></a> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#3864"><span data-toggle="tooltip" data-title="Keymap">selectKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="actions.html#16395"><span class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span></a><span class="punctuation">(</span><a href="actions.html#3864"><span data-toggle="tooltip" data-title="Keymap">selectKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <a href="actions.html#18050"><span data-toggle="tooltip" data-title="true">selecting</span></a><span class="punctuation">)</span>
        <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><a href="actions.html#3840"><span data-toggle="tooltip" data-title="Keymap">baseKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">)</span>
            <span class="keyword">await</span> <a href="actions.html#16395"><span class="member" data-toggle="tooltip" data-title="(action: Action, selecting: boolean) =&gt; Promise&lt;void&gt;">execute</span></a><span class="punctuation">(</span><a href="actions.html#3840"><span data-toggle="tooltip" data-title="Keymap">baseKeymap</span></a><span class="punctuation">[</span><a href="actions.html#18038"><span data-toggle="tooltip" data-title="string">key</span></a><span class="punctuation">]</span><span class="punctuation">,</span> <a href="actions.html#18050"><span data-toggle="tooltip" data-title="boolean">selecting</span></a><span class="punctuation">)</span>
        <span class="keyword">else</span>
            <a href="actions.html#18137"><span class="member" data-toggle="tooltip" data-title="() =&gt; void">error</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
    <span class="punctuation">}</span>
    <span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation">!</span><a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a> <span class="punctuation">&amp;&amp;</span> <a href="actions.html#18093"><span data-toggle="tooltip" data-title="boolean">userInitiated</span></a><span class="punctuation">)</span>
        <a href="actions.html#4351"><span data-toggle="tooltip" data-title="string[]">keySequence</span></a> <span class="punctuation">=</span> <span class="punctuation">[</span><span class="punctuation">]</span>
    <span class="keyword">return</span> <span class="punctuation">!</span><a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a>
<span class="punctuation">}</span>
</code></pre>
<h2 id="keymap-help">Keymap Help</h2>
<p>When defining complex key sequences you can help the user by defining what
keys she can press next and what they do. If the help is defined, it is shown
in the status bar.</p>
<pre class="syntaxhighlight"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="18961" class="member" data-toggle="tooltip" data-title="() =&gt; string | undefined">getHelp</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">string</span> <span class="punctuation">|</span> <span class="keyword">undefined</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="actions.html#4027"><span data-toggle="tooltip" data-title="Keymap | null">currentKeymap</span></a><span class="punctuation">?.</span><a href="actions.html#2949"><span data-toggle="tooltip" data-title="string | undefined">help</span></a>
<span class="punctuation">}</span>
</code></pre>

        
    </div>
            <div class="stickypane">
                
    <div class="pagemenu">
        <h3>On This Page</h3>
            <ul class="pagetree">
                
            </ul>
    </div>
                
            </div>
        </div>
    </div>
    <script src="../js/main.js"></script>
    
</body>
</html>